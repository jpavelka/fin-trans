(this["webpackJsonpfin-trans"]=this["webpackJsonpfin-trans"]||[]).push([[0],{484:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(20),o=a.n(r),i=a(90);a(407),a(485);const c=i.a.initializeApp({apiKey:"AIzaSyDIpxHzHlYDZ1jthEAl5FqVVvH1-Wa-iic",authDomain:"finances-270712.firebaseapp.com",databaseURL:"https://finances-270712.firebaseio.com",projectId:"finances-270712",storageBucket:"finances-270712.appspot.com",messagingSenderId:"974035741943"}),l=i.a.firestore();var m=a(44),d=a.n(m);const u=e=>{let{array:t,reverse:a=!1}=e,n=Array.from(new Set(t)).sort();return a?n.reverse():n};var j=a(7);const g=s.a.createContext(),h="YYYY-MM",b=e=>{let{children:t}=e;const[a,s]=Object(n.useState)(),[r,o]=Object(n.useState)(),[m,b]=Object(n.useState)([]),[f,p]=Object(n.useState)(),[x,y]=Object(n.useState)({}),[O,C]=Object(n.useState)(),[T,v]=Object(n.useState)(!0);return Object(n.useEffect)((()=>{c.auth().onAuthStateChanged((e=>{if(e&&(C(e),0===Object.keys(x).length&&l.collection("settings").where(i.a.firestore.FieldPath.documentId(),"in",["categoryChanges","metaCategories","general"]).onSnapshot((e=>{let t={};for(let a of e.docs){const e=a.id,n=a.data()||{};t[e]=n}y(t)})),x.general)){a!==x.general.minMonth&&(s(d()(x.general.maxMonth).add(-11,"month").format(h)),o(d()(x.general.maxMonth).format(h)));let e=d()(a+"-01").format(h),t=[];for(;e<=r;){const a=e;Object.keys(f||{}).includes(a)||t.push(a),e=d()(e+"-01").add(1,"month").format(h)}if(t.filter((e=>!m.includes(e))).length>0){const e=u({array:m.concat(t)});l.collection("months").where(i.a.firestore.FieldPath.documentId(),">=",e[0]).where(i.a.firestore.FieldPath.documentId(),"<=",e[e.length-1]).onSnapshot((e=>{v(!0);let t={};for(let a of e.docs){const e=a.id;let n=(a.data()||{}).transactions||[];for(let t of n)Object.keys(t).includes("comment")&&!Object.keys(t).includes("comments")&&(t.comments=t.comment);t[e]=n}p((e=>({...e,...t}))),v(!1)})),b(e)}}}))}),[a,r,f,x,m]),Object(j.jsx)(g.Provider,{value:{currentUser:O,txData:f,setMinLoadMonth:s,setCurrentUser:C,settings:x,minLoadMonth:a,maxLoadMonth:r,loadingData:T},children:t})};var f=e=>{let{history:t}=e;const{currentUser:a}=Object(n.useContext)(g);a&&t.push("/fin-trans");const s=i.a.auth(),r=new i.a.auth.GoogleAuthProvider;return Object(j.jsx)("button",{className:"login-provider-button",onClick:()=>{s.signInWithPopup(r).then((e=>{t.push("/fin-trans")})).catch((e=>{console.log(e.message)}))},children:Object(j.jsx)("span",{children:"Sign in with Google"})})},p=a(519),x=a(161),y=a.n(x),O=a(375),C=a.n(O),T=a(385),v=a.n(T),k=a(376),F=a.n(k),M=a(383),w=a.n(M),S=a(271),V=a.n(S),Y=a(270),A=a.n(Y),D=a(377),R=a.n(D),z=a(378),_=a.n(z),L=a(380),$=a.n(L),I=a(381),P=a.n(I),E=a(382),K=a.n(E),U=a(386),H=a.n(U),q=a(379),N=a.n(q),B=a(384),W=a.n(B),G=a(387),J=a.n(G);var Z={Add:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(C.a,{...e,ref:t}))),Check:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(F.a,{...e,ref:t}))),Clear:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(A.a,{...e,ref:t}))),Delete:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(R.a,{...e,ref:t}))),DetailPanel:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(V.a,{...e,ref:t}))),Edit:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(_.a,{...e,ref:t}))),Export:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(N.a,{...e,ref:t}))),Filter:Object(n.forwardRef)(((e,t)=>Object(j.jsx)($.a,{...e,ref:t}))),FirstPage:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(P.a,{...e,ref:t}))),LastPage:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(K.a,{...e,ref:t}))),NextPage:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(V.a,{...e,ref:t}))),PreviousPage:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(w.a,{...e,ref:t}))),ResetSearch:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(A.a,{...e,ref:t}))),Search:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(W.a,{...e,ref:t}))),SortArrow:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(v.a,{...e,ref:t}))),ThirdStateCheck:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(H.a,{...e,ref:t}))),ViewColumn:Object(n.forwardRef)(((e,t)=>Object(j.jsx)(J.a,{...e,ref:t})))};var Q=e=>{let{transactions:t,filterValues:a={}}=e;const s=Object(n.useRef)(null),r=[{title:"Date",field:"date",defaultSort:"desc"},{title:"Amount",field:"amount",type:"currency"},{title:"Category",field:"category"},{title:"Meta Category",field:"metaCategory"},{title:"Account",field:"account"},{title:"Tags",field:"tags"},{title:"Description",field:"description"},{title:"Comments",field:"comments"}];for(let n of r)Object.keys(a).includes(n.field)&&(n.defaultFilter=a[n.field]);const[o,i]=Object(n.useState)(0),[c,l]=Object(n.useState)(0);Object(n.useEffect)((()=>{setTimeout((()=>{i((s.current?s.current.state.data:t).map((e=>e.amount)).reduce(((e,t)=>e+t))),l((s.current?s.current.state.data:t).length)}),100)}),[t,a]);const m=()=>{i(s.current.state.data.map((e=>e.amount)).reduce(((e,t)=>e+t),0)),l(s.current.state.data.length)};return Object(j.jsx)("div",{children:Object(j.jsx)(y.a,{title:`$${(Math.round(100*o,2)/100).toLocaleString()} (${c} transactions)`,tableRef:s,data:t,columns:r,icons:Z,options:{filtering:!0},onFilterChange:m,onSearchChange:m})})},X=a(218),ee=a.n(X),te=a(388),ae=a.n(te);const ne=e=>{let{allTx:t,groupOn:a,includeAll:n}=e;const[s,r]=Array.isArray(a)?[a[0],a.slice(1)]:[a,[]],[o,i]=Array.isArray(n)?[n[0],n.slice(1)]:[n,[]],c=u({array:t.map((e=>e[s]))});let l={};for(const m of c)l[m]=[];for(const m of t)l[m[s]].push(m);if(o&&(l._all=t),r.length>0)for(const m of Object.keys(l))l[m]=ne({allTx:l[m],groupOn:r,includeAll:i});return l},se=e=>{let{timeFrame:t,time:a}=e;return"month"===t?d()(a+"-01").add(1,"month").format("YYYY-MM"):d()(a+"-01-01").add(1,"year").format("YYYY")},re=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),oe=e=>{let{d:t,timeFrame:a}=e;return"month"===a?d()(t+"-01").format("MMM YYYY"):t},ie=e=>{let{d:t,timeFrame:a}=e;return"month"===a?d()("1 "+t).format("YYYY-MM"):t},ce=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],le=e=>{let{groupedData:t}=e,a={type:"bar",hoverinfo:"text",x:[],y:[],text:[]};for(const n of u({array:Object.keys(t)})){const e=t[n].map((e=>e.amount)).reduce(((e,t)=>e+t),0);a.x.push(n),a.y.push(e),a.text.push(`${n}<br>${re(e)}`)}return[a]},me=e=>{let{timeFrame:t,time:a,txType:n,metaCategory:s}=e;return{title:`${"_all"===s?"All":s} ${"expense"===n?"Expenses":"Income"} - ${oe({d:a,timeFrame:t})}`,autosize:!0,hovermode:"closest"}};var de=e=>{let{plotTx:t,metaCategory:a,timeFrame:n,time:s,txType:r,setTableFilters:o}=e;const i="_all"===a?"metaCategory":"category",c=ne({allTx:t,groupOn:[i],includeAll:[!1]}),l=le({groupedData:c}),m=me({timeFrame:n,time:s,txType:r,metaCategory:a});return Object(j.jsx)(ee.a,{layout:m,data:l,useResizeHandler:!0,style:{width:"100%",height:"100%"},onClick:e=>{let t={};t[i]=e.points[0].x,o(t)}})};const ue=e=>{let{timeFrame:t,minTime:a,maxTime:n,txType:s,metaCategory:r}=e;return{title:`${`${"month"===t?"Month":"Year"}ly Trends - ${"expense"===s?"Expenses":"Income"}${"_all"===r?"":" - "+r}`}<br><sub>${`${oe({d:a,timeFrame:t})} - ${oe({d:n,timeFrame:t})}`}</sub>`,autosize:!0,hovermode:"closest"}},je=e=>{let{groupedData:t,groupOn:a,timeFrame:n,minTime:s,maxTime:r,includeAverages:o}=e,i=[];for(const[c,l]of Object.entries(t)){let e=s,t=[],m=[],d=[];const u="_all"===c?"Total":c;for(;e<=r;){t.push(oe({d:e,timeFrame:n}));let a=0;for(const t of l[e]||[])a+=t.amount;m.push(a),d.push(`${u}<br>${oe({d:e,timeFrame:n})}<br>${re(a)}`),e=se({timeFrame:n,time:e})}const j=m.reduce(((e,t)=>e+t),0),g={_cat:c,_groupOn:a,name:`${u} - ${re(j)}`,legendgroup:c,type:"scatter",hoverinfo:"text",text:d,x:t,y:m};if(i.push(g),o){const e=j/g.y.length,t={...g,_cat:g._cat+"_avg",_isAvg:!0,line:{dash:"dash"},showlegend:!1,text:`Avg. ${u}<br>${re(e)}`,y:g.y.map((t=>e))};i.push(t)}}return i=i.sort(((e,t)=>([e,t]=[e,t].map((e=>e._cat.replace("_","A".repeat(10)))),e<t?-1:1))),i=(e=>{let t=0;for(const a of e){a.line=a.line||{};let e=0;a._isAvg&&(t-=1,e=.5);const n=ae()(ce[t%ce.length]);a.line.color=n.fade(e).rgb().string(),t+=1}return e})(i),i},ge=e=>{let{includeAverages:t,setIncludeAverages:a}=e;return Object(j.jsxs)("div",{style:{margin:"5pt 10pt"},children:["Include Avg. ",Object(j.jsx)("input",{type:"checkbox",checked:t,onChange:e=>a(e.target.checked)})]})};var he=e=>{let{plotTx:t,txType:a,metaCategory:s,timeFrame:r,minTime:o,maxTime:i,setTableFilters:c}=e;const[l,m]=Object(n.useState)(!0),d="_all"===s?"metaCategory":"category",u=ne({allTx:t,groupOn:[d,r],includeAll:[!0,!1]}),g=je({groupedData:u,groupOn:d,timeFrame:r,minTime:o,maxTime:i,includeAverages:l}),h=ue({timeFrame:r,minTime:o,maxTime:i,txType:a,metaCategory:s});return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(ge,{includeAverages:l,setIncludeAverages:m}),Object(j.jsx)(ee.a,{layout:h,data:g,useResizeHandler:!0,style:{width:"100%",height:"100%"},onClick:e=>{const t=e.points[0].data;if(t._isAvg)return;let a={date:ie({d:e.points[0].x,timeFrame:r})};"_all"!==t._cat&&(a[d]=t._cat),c(a)}})]})};var be=e=>{let{plotTx:t,selectionValues:a,setTableFilters:n}=e;return Object(j.jsx)("div",{style:{height:"550px"},children:"trend"===a.plotType?Object(j.jsx)(he,{plotTx:t,txType:a.txType,metaCategory:a.metaCategory,timeFrame:a.timeFrame,minTime:a.minTime,maxTime:a.maxTime,setTableFilters:n}):Object(j.jsx)(de,{plotTx:t,txType:a.txType,metaCategory:a.metaCategory,timeFrame:a.timeFrame,time:a.maxTime,setTableFilters:n})})},fe=a(223),pe=a(516);a(261);const xe=e=>e.replace("-","").replace("/","").replace(" ",""),ye=e=>{let{show:t,metaCat:a,metaCategories:n,checkChanged:s,setCheckChanged:r,selectionValues:o,disabledMetaCategories:i,setDisabledMetaCategories:c}=e;return Object(j.jsxs)("div",{style:{marginTop:"5pt",...t?{}:{display:"none"}},children:[Object(j.jsx)("input",{type:"checkbox",id:Te(a),defaultChecked:!o.inactiveMetaCategories.includes(a),onChange:e=>{Oe({catOrMetaCat:"metaCats",key:a,setCheckChanged:r})}}),Object(j.jsxs)("label",{for:Te(a),children:["\xa0\xa0",a]}),Object(j.jsx)("div",{style:{marginLeft:"5pt"},children:n[a].map((e=>Object(j.jsxs)("div",{children:[Object(j.jsx)("input",{id:ve(e),type:"checkbox",defaultChecked:!o.inactiveCategories.includes(e),disabled:o.inactiveMetaCategories.includes(a)&&!s.metaCats[a]||!o.inactiveMetaCategories.includes(a)&&!!s.metaCats[a],onChange:()=>Oe({catOrMetaCat:"cats",key:e,setCheckChanged:r})}),Object(j.jsxs)("label",{for:ve(e),children:["\xa0\xa0",e]})]})))})]})},Oe=e=>{let{catOrMetaCat:t,key:a,setCheckChanged:n}=e;const s="cats"===t?"metaCats":"cats";n((e=>{let n=e[t];const r=e[s];n[a]=!n[a];let o={};return o[t]=n,o[s]=r,o}))},Ce=e=>u({array:Object.keys(e)}).map((e=>({originalValue:e,value:xe(e),label:e}))),Te=e=>`${xe(e)}MetaCatSel`,ve=e=>`${xe(e)}CatSel`;var ke=e=>{let{show:t,setShow:a,metaCategories:s,selectionValues:r,setSelectionValues:o}=e;const i=Ce(s),[c,l]=Object(n.useState)(i[0]),[m,d]=Object(n.useState)([]),[u,g]=Object(n.useState)({metaCats:{},cats:{}}),h=c.originalValue,b=()=>{g({metaCats:{},cats:{}}),a(!1)};return Object(j.jsx)("div",{children:Object(j.jsxs)(pe.a,{show:t,children:[Object(j.jsx)(pe.a.Header,{children:Object(j.jsx)("h3",{children:"Category Detail"})}),Object(j.jsxs)(pe.a.Body,{children:["Select a meta-category",Object(j.jsx)(fe.a,{options:i,defaultValue:c,onChange:e=>l(e)}),Object.keys(s).map((e=>Object(j.jsx)(ye,{metaCat:e,metaCategories:s,checkChanged:u,setCheckChanged:g,selectionValues:r,disabledMetaCategories:m,setDisabledMetaCategories:d,show:e===h})))]}),Object(j.jsxs)(pe.a.Footer,{children:[Object(j.jsx)("button",{onClick:()=>{o((e=>{let t=e.inactiveMetaCategories;for(const n of Object.keys(u.metaCats))u.metaCats[n]&&(t.includes(n)?t=t.filter((e=>e!==n)):t.push(n));let a=e.inactiveCategories;for(const n of Object.keys(u.cats))u.cats[n]&&(a.includes(n)?a=a.filter((e=>e!==n)):a.push(n));return{...e,inactiveMetaCategories:t,inactiveCategories:a}})),b()},children:"Save"}),Object(j.jsx)("button",{onClick:()=>b(),children:"Cancel"})]})]})})};var Fe=e=>{let{show:t,setShow:a,selectionValues:s,setSelectionValues:r,allTags:o}=e;const i={};for(const n of o)i[n]=s.requiredTags.includes(n)?"must":s.forbiddenTags.includes(n)?"cannot":"can";const[c,l]=Object(n.useState)(i),m=e=>{r((t=>({...t,...{requiredTags:Object.keys(e).filter((t=>"must"===e[t])),forbiddenTags:Object.keys(e).filter((t=>"cannot"===e[t]))}}))),a(!1)};return Object(j.jsx)("div",{children:Object(j.jsxs)(pe.a,{show:t,children:[Object(j.jsx)(pe.a.Header,{children:Object(j.jsx)("h3",{children:"Tag Detail"})}),Object(j.jsx)(pe.a.Body,{children:Object(j.jsxs)("table",{children:[Object(j.jsx)("thead",{children:Object(j.jsxs)("tr",{children:[Object(j.jsx)("td",{}),["Can Have","Must Have","Can't Have"].map((e=>Object(j.jsx)("td",{style:{textAlign:"center",padding:"5pt"},children:e})))]})}),Object(j.jsx)("tbody",{children:o.map((e=>Object(j.jsxs)("tr",{children:[Object(j.jsx)("td",{children:e}),["can","must","cannot"].map((t=>{const a=(c[e]||"can")===t;return Object(j.jsx)("td",{style:{textAlign:"center"},children:Object(j.jsx)("input",{type:"radio",name:e,value:t,defaultChecked:a,onChange:e=>{l((t=>{let a={};return a[e.target.name]=e.target.value,{...t,...a}}))}})})}))]})))})]})}),Object(j.jsxs)(pe.a.Footer,{children:[Object(j.jsx)("button",{onClick:()=>m(c),children:"Save"}),Object(j.jsx)("button",{onClick:()=>m(i),children:"Cancel"})]})]})})};const Me=e=>{let{label:t,options:a,selectionKey:n,selectionValues:s,setSelectionValues:r,minLoadMonth:o,setMinLoadMonth:i}=e;a=a.map((e=>"string"===typeof e?e={value:e,label:e}:e)).map((e=>({originalValue:e.value,value:xe(e.value),label:e.label})));let c=a.filter((e=>e.originalValue===s[n]));return Object(j.jsxs)("div",{style:{width:"100pt",marginLeft:"10pt"},children:[t,Object(j.jsx)(fe.a,{options:a,value:c,onChange:e=>{const t=e.originalValue;if(we({key:n,val:t,setValueFunc:r}),"plotTypeFull"===n&&("monthTrend"===t?(we({key:"plotType",val:"trend",setValueFunc:r}),we({key:"timeFrame",val:"month",setValueFunc:r})):"singleMonth"===t?(we({key:"plotType",val:"singlePeriod",setValueFunc:r}),we({key:"timeFrame",val:"month",setValueFunc:r})):"yearTrend"===t?(we({key:"plotType",val:"trend",setValueFunc:r}),we({key:"timeFrame",val:"year",setValueFunc:r})):"singleYear"===t&&(we({key:"plotType",val:"singlePeriod",setValueFunc:r}),we({key:"timeFrame",val:"year",setValueFunc:r}))),"timeFrame"===n)if("trend"===s.plotType)if("year"===t){const e=s.minTime.slice(0,4);we({key:"minTime",val:e,setValueFunc:r}),we({key:"maxTime",val:s.maxTime.slice(0,4),setValueFunc:r}),e+"-01"<o&&i(e+"-01")}else we({key:"minTime",val:s.minTime+"-01",setValueFunc:r}),we({key:"maxTime",val:s.maxTime+"-12",setValueFunc:r});else if("year"===t){const e=s.maxTime.slice(0,4);we({key:"maxTime",val:e,setValueFunc:r}),e+"-01"<o&&i(e+"-01")}else we({key:"maxTime",val:s.maxTime+"-01",setValueFunc:r})}})]})},we=e=>{let{key:t,val:a,setValueFunc:n}=e;n((e=>{let n={};return n[t]=a,{...e,...n}}))};var Se=e=>{let{selectionValues:t,setSelectionValues:a,allMetaCats:s,allTimes:r,metaCategories:o,allTags:i}=e;const{settings:c,minLoadMonth:l,setMinLoadMonth:m}=Object(n.useContext)(g),[d,u]=Object(n.useState)(!1),[h,b]=Object(n.useState)(!1);s=[{value:"_all",label:"All"}].concat(s);const f=(e=>{let{settings:t,allMetaCats:a,selectionValues:n,allTimes:s}=e;const r=[[{label:"Category Grouping",options:Object.keys(t.metaCategories).filter((e=>"_default"!==e)),selectionKey:"metaCatVersion"},{label:"Category Changes",options:Object.keys(t.categoryChanges).filter((e=>"_default"!==e)),selectionKey:"categoryChangeVersion"}],[{label:"Plot Type",options:[{value:"monthTrend",label:"Month Trend"},{value:"singleMonth",label:"Single Month"},{value:"yearTrend",label:"Year Trend"},{value:"singleYear",label:"Month Year"}],selectionKey:"plotTypeFull"}]],o=r.length-1;return"trend"===n.plotType?r[o]=r[o].concat([{label:"Start "+("month"===n.timeFrame?"Month":"Year"),options:s,selectionKey:"minTime"},{label:"End "+("month"===n.timeFrame?"Month":"Year"),options:s,selectionKey:"maxTime"}]):r[o]=r[o].concat([{label:"month"===n.timeFrame?"Month":"Year",options:s,selectionKey:"maxTime"}]),r.push([{label:"Meta Category",options:a,selectionKey:"metaCategory"}]),r})({settings:c,allMetaCats:s,selectionValues:t,allTimes:r}),p=f.map((e=>{const n=e.map((e=>Object(j.jsx)(Me,{selectionValues:t,setSelectionValues:a,minLoadMonth:l,setMinLoadMonth:m,...e},e.selectionKey)));return Object(j.jsx)("div",{style:{display:"flex",marginTop:"5pt"},children:n},e[0].selectionKey)})),x=Object(j.jsxs)("div",{style:{margin:"10pt"},children:[Object(j.jsx)("button",{onClick:()=>u(!0),style:{marginRight:"5pt"},children:"Category Detail"}),Object(j.jsx)("button",{onClick:()=>b(!0),children:"Tag Detail"}),Object(j.jsxs)("span",{style:{marginLeft:"0.5rem"},children:[Object(j.jsx)("input",{type:"checkbox",id:"selectAmortizeCheckbox",defaultChecked:t.amortize,onChange:()=>{we({key:"amortize",val:!t.amortize,setValueFunc:a})}}),Object(j.jsx)("label",{for:"selectAmortizeCheckbox",children:"\xa0\xa0Use Amortization"})]}),Object(j.jsx)(ke,{show:d,setShow:u,selectionValues:t,setSelectionValues:a,metaCategories:o}),Object(j.jsx)(Fe,{show:h,setShow:b,selectionValues:t,setSelectionValues:a,allTags:i})]});return Object(j.jsxs)(j.Fragment,{children:[p,x,Object(j.jsx)("hr",{})]})};var Ve=e=>{let{transactions:t,metaCategories:a,categoryChanges:n}=e;const s=Object.keys(n||{});let r={};for(const i of Object.keys(a||{}))for(const e of a[i])r[e]=i;let o=[];for(let i of t)if(s.includes(i.category)&&(i.category=n[i.category]),i.metaCategory=r[i.category]||"Misc",i.type=i.amount<0?"expense":"income",i.tags=i.tags||[],"string"===typeof i.tags&&(i.tags=i.tags.split(",").map((e=>e.toLowerCase().trim()))),i.tags=i.tags.filter((e=>""!==e.trim())),i.month=d()(i.date).format("YYYY-MM"),i.year=d()(i.date).format("YYYY"),i.amortize){i.amortize=parseInt(i.amortize),i.skipIfAmortize=!0;for(let e=0;e<i.amortize;e++){const t={date:d()(i.date).add(e,"month").format("YYYY-MM-DD"),amount:i.amount/i.amortize,skipIfAmortize:!1,skipIfNoAmortize:!0};t.month=d()(t.date).format("YYYY-MM"),t.year=d()(t.date).format("YYYY"),o.push({...i,...t})}}return t.concat(o).filter((e=>"Ignore"!==e.metaCategory)).map((e=>({...e,amount:Math.abs(e.amount)})))};var Ye=e=>{let{history:t}=e;const{currentUser:a,setCurrentUser:s,txData:r,settings:o,minLoadMonth:i,maxLoadMonth:l,setMinLoadMonth:m,loadingData:h}=Object(n.useContext)(g),[b,f]=Object(n.useState)({metaCatVersion:void 0,categoryChangeVersion:void 0,txType:"expense",inactiveCategories:[],inactiveMetaCategories:[],requiredTags:[],forbiddenTags:[],metaCategory:"_all",plotType:"trend",timeFrame:"month",plotTypeFull:"monthTrend",minTime:void 0,maxTime:void 0,amortize:!1}),[x,y]=Object(n.useState)({}),[O,C]=Object(n.useState)(h);Object(n.useEffect)((()=>{C(h)}),[h]),Object(n.useEffect)((()=>{b.minTime&&m((e=>{const t=4===b.minTime.length?b.minTime+"-01":b.minTime;return t<e?t:e}))}),[b.minTime,m]),Object(n.useEffect)((()=>{o&&i&&l&&f((e=>{let t={};return e.metaCatVersion||(t.metaCatVersion=(o.metaCategories||{})._default),e.categoryChanges||(t.categoryChangeVersion=(o.categoryChanges||{})._default),e.minTime||(t.minTime=i),e.maxTime||(t.maxTime=l),{...e,...t}}))}),[o,i,l]);let T=[];for(const n of Object.keys(r||{}))T=T.concat(Ve({transactions:r[n],metaCategories:o.metaCategories[b.metaCatVersion],categoryChanges:o.categoryChanges[b.categoryChangeVersion]}));if(a||t.push("/fin-trans/login"),!o||!b.metaCatVersion||!b.categoryChangeVersion)return Object(j.jsx)("div",{children:"Loading..."});let v=[];for(const n of T)v=v.concat(n.tags||[]);v=u({array:v}),T=T.filter((e=>e[b.timeFrame]>=b.minTime&&e[b.timeFrame]<=b.maxTime&&e.type===b.txType&&!b.inactiveCategories.includes(e.category)&&!b.inactiveMetaCategories.includes(e.metaCategory)&&(e.tags||[]).map((e=>b.requiredTags.includes(e)?1:0)).reduce(((e,t)=>e+t),0)===b.requiredTags.length&&0===(e.tags||[]).map((e=>b.forbiddenTags.includes(e)?1:0)).reduce(((e,t)=>e+t),0)&&(b.amortize?!e.skipIfAmortize:!e.skipIfNoAmortize))),T=T.filter((e=>"trend"===b.plotType?e[b.timeFrame]>=b.minTime&&e[b.timeFrame]<=b.maxTime:e[b.timeFrame]===b.maxTime));const k=u({array:T.map((e=>e.metaCategory))});T=T.filter((e=>"_all"===b.metaCategory||e.metaCategory===b.metaCategory));const F=(e=>{let{minTime:t,maxTime:a,timeFrame:n,reverse:s=!1}=e,r=[],o=t;for(;o<=a;){const e=o;r.push(e),o=d()(e+("month"===n?"-01":"-01-01")).add(1,n).format("month"===n?"YYYY-MM":"YYYY")}return s&&r.reverse(),r})({minTime:o.general.minMonth,maxTime:o.general.maxMonth,timeFrame:b.timeFrame,reverse:!0});return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("button",{onClick:()=>{window.confirm("Are you sure you want to sign out?")&&c.auth().signOut(),s(),t.push("/fin-trans/login")},children:"Sign Out"}),Object(j.jsx)(Se,{selectionValues:b,setSelectionValues:f,allMetaCats:k,allTimes:F,metaCategories:o.metaCategories[b.metaCatVersion],allTags:v}),O?Object(j.jsx)("h3",{style:{textAlign:"center"},children:"Waiting for data to load..."}):Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)(p.a,{defaultActiveKey:"0",children:[Object(j.jsx)(p.a.Toggle,{eventKey:"0",children:"Toggle Plot"}),Object(j.jsx)(p.a.Collapse,{eventKey:"0",children:Object(j.jsx)(be,{plotTx:T,selectionValues:b,setTableFilters:y})})]}),Object(j.jsx)("hr",{}),Object(j.jsxs)(p.a,{defaultActiveKey:"0",children:[Object(j.jsx)(p.a.Toggle,{eventKey:"0",children:"Toggle Table"}),Object(j.jsx)(p.a.Collapse,{eventKey:"0",children:Object(j.jsx)(Q,{transactions:T,filterValues:x})})]})]})]})},Ae=a(390),De=a.n(Ae);const Re=l.collection("months"),ze=async e=>{for(let s of e)s.date=new Date(Date.parse(s.date)).toISOString().substring(0,10);const t=u({array:e.map((e=>e.date.slice(0,7)))});let a={},n={};for(const s of t)n[s]=[],a[s]=await _e(s);e.map((e=>n[e.date.slice(0,7)].push(e)));for(const s of t){let e=a[s].concat(n[s]);Re.doc(s).set({transactions:e},{merge:!0}).then((()=>{window.alert("Transactions uploaded successfully for month "+s)})).catch((e=>{window.alert("There was an issue uploading the transactions: ",e)}))}},_e=async e=>(await Le(e)).transactions||[],Le=e=>Re.doc(e).get().then((function(t){return t.exists?t.data():($e(e),{transactions:[]})})).catch((function(e){return console.log("Error getting documents: ",e),null}));function $e(e){const t=l.doc("settings/general");t.get().then((function(a){const n=a.data();e<n.minMonth?t.set({minMonth:e},{merge:!0}):e>n.maxMonth&&t.set({maxMonth:e},{merge:!0})})).catch((function(e){return console.log("Error getting settings: ",e),null}))}var Ie=()=>Object(j.jsx)(De.a,{cssClass:"csv-reader-input",label:"Select CSV to upload",parserOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0,transformHeader:e=>e.toLowerCase().replace(/\W/g,"_")},onFileLoaded:ze,onError:e=>console.log(e)}),Pe=a(520),Ee=a(517),Ke=a(145);var Ue=()=>Object(j.jsxs)(Pe.a,{bg:"dark",variant:"dark",expand:"lg",children:[Object(j.jsx)(Pe.a.Brand,{as:Ke.b,to:"/fin-trans",children:"Transactions"}),Object(j.jsx)(Pe.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(j.jsx)(Pe.a.Collapse,{id:"basic-navbar-nav",children:Object(j.jsxs)(Ee.a,{className:"mr-auto",children:[Object(j.jsx)(Ee.a.Link,{as:Ke.b,to:"/fin-trans/upload",children:"Upload"}),Object(j.jsx)(Ee.a.Link,{as:Ke.b,to:"/fin-trans/edit",children:"Edit"})]})})]}),He=a(35);var qe=()=>{const{currentUser:e,txData:t}=Object(n.useContext)(g),[a,s]=Object(n.useState)([]),r=()=>{const e=[];for(const a of Object.values(t||{}))for(const t of a)t.tags&&(t.tags="string"===typeof t.tags?t.tags:t.tags.join(",")),e.push(t);return e},[o,i]=Object(n.useState)(r());if(!e)return Object(j.jsx)("div",{children:"Loading..."});return Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{onClick:()=>{i(r()),s([])},children:"Undo All"}),Object(j.jsx)("button",{onClick:()=>{for(const e of u({array:a})){const a=o.filter((t=>t.date.slice(0,7)===e));Re.doc(e).set({transactions:a},{merge:!0}).then((()=>{window.alert("Transactions uploaded successfully for month "+e)})).catch((e=>{window.alert("There was an issue uploading the transactions: ",e)})),Object.keys(t).includes(e)||$e(e)}s([])},children:"Save All"}),Object(j.jsx)(He.a,{when:a.length>0,message:"You have unsaved changes. Please either save or undo changes."}),Object(j.jsx)(y.a,{title:"Raw Transaction Data",data:o,columns:[{title:"Date",field:"date",defaultSort:"desc"},{title:"Description",field:"description"},{title:"Amount",field:"amount"},{title:"Category",field:"category"},{title:"Comments",field:"comments"},{title:"Tags",field:"tags"},{title:"Account",field:"account"},{title:"Amortization (Months)",field:"amortize"}],icons:Z,options:{filtering:!0},editable:{onRowAdd:e=>new Promise(((t,n)=>{setTimeout((()=>{i([...o,e]),s([...a,e.date.slice(0,7)]),t()}),1e3)})),onRowUpdate:(e,t)=>new Promise(((n,r)=>{setTimeout((()=>{const r=[...o];r[t.tableData.id]=e,i([...r]),s([...a,e.date.slice(0,7),t.date.slice(0,7)]),n()}),1e3)})),onRowDelete:e=>new Promise(((t,n)=>{setTimeout((()=>{const n=[...o],r=e.tableData.id;n.splice(r,1),i([...n]),s([...a,e.date.slice(0,7)]),t()}),1e3)}))}})]})};var Ne=()=>Object(j.jsx)(b,{children:Object(j.jsxs)(Ke.a,{children:[Object(j.jsx)(Ue,{}),Object(j.jsx)(He.d,{children:Object(j.jsxs)("div",{style:{margin:"5pt"},children:[Object(j.jsx)(He.b,{exact:!0,path:"/fin-trans",component:Ye}),Object(j.jsx)(He.b,{exact:!0,path:"/fin-trans/login",component:f}),Object(j.jsx)(He.b,{exact:!0,path:"/fin-trans/upload",component:Ie}),Object(j.jsx)(He.b,{exact:!0,path:"/fin-trans/edit",component:qe})]})})]})});o.a.render(Object(j.jsx)(s.a.StrictMode,{children:Object(j.jsx)(Ne,{})}),document.getElementById("root"))}},[[484,1,2]]]);
//# sourceMappingURL=main.5b74e9ef.chunk.js.map