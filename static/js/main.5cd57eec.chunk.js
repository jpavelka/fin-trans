(this["webpackJsonpfin-trans"]=this["webpackJsonpfin-trans"]||[]).push([[0],{493:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(21),i=a.n(c),o=a(93),s=a(15),l=a(34),u=a(28),f=(a(416),a(494),o.a.initializeApp({apiKey:"AIzaSyDIpxHzHlYDZ1jthEAl5FqVVvH1-Wa-iic",authDomain:"finances-270712.firebaseapp.com",databaseURL:"https://finances-270712.firebaseio.com",projectId:"finances-270712",storageBucket:"finances-270712.appspot.com",messagingSenderId:"974035741943"})),j=o.a.firestore(),d=a(70),m=a.n(d),b=function(e){var t=e.array,a=e.reverse,n=void 0!==a&&a,r=Array.from(new Set(t)).sort();return n?r.reverse():r},h=a(7),g=r.a.createContext(),O="YYYY-MM",y=function(e){var t=e.children,a=Object(n.useState)(),r=Object(u.a)(a,2),c=r[0],i=r[1],d=Object(n.useState)(),y=Object(u.a)(d,2),v=y[0],x=y[1],p=Object(n.useState)([]),C=Object(u.a)(p,2),T=C[0],k=C[1],w=Object(n.useState)(),M=Object(u.a)(w,2),F=M[0],S=M[1],V=Object(n.useState)({}),A=Object(u.a)(V,2),Y=A[0],D=A[1],_=Object(n.useState)(),R=Object(u.a)(_,2),L=R[0],P=R[1],K=Object(n.useState)(!0),E=Object(u.a)(K,2),I=E[0],U=E[1];return Object(n.useEffect)((function(){f.auth().onAuthStateChanged((function(e){if(e&&(P(e),0===Object.keys(Y).length&&j.collection("settings").where(o.a.firestore.FieldPath.documentId(),"in",["categoryChanges","metaCategories","general"]).onSnapshot((function(e){var t,a={},n=Object(l.a)(e.docs);try{for(n.s();!(t=n.n()).done;){var r=t.value,c=r.id,i=r.data()||{};a[c]=i}}catch(o){n.e(o)}finally{n.f()}D(a)})),Y.general)){c!==Y.general.minMonth&&(i(m()(Y.general.maxMonth).add(-11,"month").format(O)),x(m()(Y.general.maxMonth).format(O)));for(var t=m()(c+"-01").format(O),a=[];t<=v;){var n=t;Object.keys(F||{}).includes(n)||a.push(n),t=m()(t+"-01").add(1,"month").format(O)}if(a.filter((function(e){return!T.includes(e)})).length>0){var r=b({array:T.concat(a)});j.collection("months").where(o.a.firestore.FieldPath.documentId(),">=",r[0]).where(o.a.firestore.FieldPath.documentId(),"<=",r[r.length-1]).onSnapshot((function(e){U(!0);var t,a={},n=Object(l.a)(e.docs);try{for(n.s();!(t=n.n()).done;){var r,c=t.value,i=c.id,o=(c.data()||{}).transactions||[],u=Object(l.a)(o);try{for(u.s();!(r=u.n()).done;){var f=r.value;Object.keys(f).includes("comment")&&!Object.keys(f).includes("comments")&&(f.comments=f.comment)}}catch(j){u.e(j)}finally{u.f()}a[i]=o}}catch(j){n.e(j)}finally{n.f()}S((function(e){return Object(s.a)(Object(s.a)({},e),a)})),U(!1)})),k(r)}}}))}),[c,v,F,Y,T]),Object(h.jsx)(g.Provider,{value:{currentUser:L,txData:F,setMinLoadMonth:i,setCurrentUser:P,settings:Y,minLoadMonth:c,maxLoadMonth:v,loadingData:I},children:t})},v=function(e){var t=e.history;Object(n.useContext)(g).currentUser&&t.push("/");var a=o.a.auth(),r=new o.a.auth.GoogleAuthProvider;return Object(h.jsx)("button",{className:"login-provider-button",onClick:function(){a.signInWithPopup(r).then((function(e){t.push("/")})).catch((function(e){console.log(e.message)}))},children:Object(h.jsx)("span",{children:"Sign in with Google"})})},x=a(528),p=a(166),C=a.n(p),T=a(383),k=a.n(T),w=a(393),M=a.n(w),F=a(384),S=a.n(F),V=a(391),A=a.n(V),Y=a(278),D=a.n(Y),_=a(277),R=a.n(_),L=a(385),P=a.n(L),K=a(386),E=a.n(K),I=a(388),U=a.n(I),H=a(389),z=a.n(H),q=a(390),B=a.n(q),N=a(394),W=a.n(N),G=a(387),J=a.n(G),Z=a(392),Q=a.n(Z),X=a(395),$=a.n(X),ee={Add:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(k.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Check:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(S.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Clear:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(R.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Delete:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(P.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),DetailPanel:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(D.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Edit:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(E.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Export:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(J.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Filter:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(U.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),FirstPage:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(z.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),LastPage:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(B.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),NextPage:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(D.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),PreviousPage:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(A.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),ResetSearch:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(R.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Search:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(Q.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),SortArrow:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(M.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),ThirdStateCheck:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(W.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),ViewColumn:Object(n.forwardRef)((function(e,t){return Object(h.jsx)($.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))}))},te=function(e){for(var t=e.transactions,a=e.filterValues,n=void 0===a?{}:a,r=[{title:"Date",field:"date"},{title:"Amount",field:"amount",type:"currency"},{title:"Category",field:"category"},{title:"Meta Category",field:"metaCategory"},{title:"Account",field:"account"},{title:"Tags",field:"tags"},{title:"Description",field:"description"},{title:"Comments",field:"comments"}],c=0,i=r;c<i.length;c++){var o=i[c];Object.keys(n).includes(o.field)&&(o.defaultFilter=n[o.field])}return Object(h.jsx)("div",{children:Object(h.jsx)(C.a,{title:"Transactions",data:t,columns:r,icons:ee,options:{filtering:!0}})})},ae=a(225),ne=a.n(ae),re=a(396),ce=a.n(re),ie=function e(t){var a,n=t.allTx,r=t.groupOn,c=t.includeAll,i=Array.isArray(r)?[r[0],r.slice(1)]:[r,[]],o=Object(u.a)(i,2),s=o[0],f=o[1],j=Array.isArray(c)?[c[0],c.slice(1)]:[c,[]],d=Object(u.a)(j,2),m=d[0],h=d[1],g=b({array:n.map((function(e){return e[s]}))}),O={},y=Object(l.a)(g);try{for(y.s();!(a=y.n()).done;){O[a.value]=[]}}catch(w){y.e(w)}finally{y.f()}var v,x=Object(l.a)(n);try{for(x.s();!(v=x.n()).done;){var p=v.value;O[p[s]].push(p)}}catch(w){x.e(w)}finally{x.f()}if(m&&(O._all=n),f.length>0)for(var C=0,T=Object.keys(O);C<T.length;C++){var k=T[C];O[k]=e({allTx:O[k],groupOn:f,includeAll:h})}return O},oe=function(e){var t=e.timeFrame,a=e.time;return"month"===t?m()(a+"-01").add(1,"month").format("YYYY-MM"):m()(a+"-01-01").add(1,"year").format("YYYY")},se=function(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)},le=function(e){var t=e.d;return"month"===e.timeFrame?m()(t+"-01").format("MMM YYYY"):t},ue=function(e){var t=e.d;return"month"===e.timeFrame?m()("1 "+t).format("YYYY-MM"):t},fe=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],je=function(e){var t,a=e.groupedData,n={type:"bar",hoverinfo:"text",x:[],y:[],text:[]},r=Object(l.a)(b({array:Object.keys(a)}));try{for(r.s();!(t=r.n()).done;){var c=t.value,i=a[c].map((function(e){return e.amount})).reduce((function(e,t){return e+t}),0);n.x.push(c),n.y.push(i),n.text.push("".concat(c,"<br>").concat(se(i)))}}catch(o){r.e(o)}finally{r.f()}return[n]},de=function(e){var t=e.timeFrame,a=e.time,n=e.txType,r=e.metaCategory;return{title:"".concat("_all"===r?"All":r," ").concat("expense"===n?"Expenses":"Income"," - ").concat(le({d:a,timeFrame:t})),autosize:!0,hovermode:"closest"}},me=function(e){var t=e.plotTx,a=e.metaCategory,n=e.timeFrame,r=e.time,c=e.txType,i=e.setTableFilters,o="_all"===a?"metaCategory":"category",s=ie({allTx:t,groupOn:[o],includeAll:[!1]}),l=je({groupedData:s}),u=de({timeFrame:n,time:r,txType:c,metaCategory:a});return Object(h.jsx)(ne.a,{layout:u,data:l,useResizeHandler:!0,style:{width:"100%",height:"100%"},onClick:function(e){var t={};t[o]=e.points[0].x,i(t)}})},be=function(e){var t=e.timeFrame,a=e.minTime,n=e.maxTime,r=e.txType,c=e.metaCategory,i="".concat("month"===t?"Month":"Year","ly Trends - ").concat("expense"===r?"Expenses":"Income").concat("_all"===c?"":" - "+c),o="".concat(le({d:a,timeFrame:t})," - ").concat(le({d:n,timeFrame:t}));return{title:"".concat(i,"<br><sub>").concat(o,"</sub>"),autosize:!0,hovermode:"closest"}},he=function(e){for(var t=e.groupedData,a=e.groupOn,n=e.timeFrame,r=e.minTime,c=e.maxTime,i=e.includeAverages,o=[],f=0,j=Object.entries(t);f<j.length;f++){for(var d=Object(u.a)(j[f],2),m=d[0],b=d[1],h=r,g=[],O=[],y=[],v="_all"===m?"Total":m;h<=c;){g.push(le({d:h,timeFrame:n}));var x,p=0,C=Object(l.a)(b[h]||[]);try{for(C.s();!(x=C.n()).done;){p+=x.value.amount}}catch(w){C.e(w)}finally{C.f()}O.push(p),y.push("".concat(v,"<br>").concat(le({d:h,timeFrame:n}),"<br>").concat(se(p))),h=oe({timeFrame:n,time:h})}var T=O.reduce((function(e,t){return e+t}),0),k={_cat:m,_groupOn:a,name:"".concat(v," - ").concat(se(T)),legendgroup:m,type:"scatter",hoverinfo:"text",text:y,x:g,y:O};o.push(k),i&&function(){var e=T/k.y.length,t=Object(s.a)(Object(s.a)({},k),{_cat:k._cat+"_avg",_isAvg:!0,line:{dash:"dash"},showlegend:!1,text:"Avg. ".concat(v,"<br>").concat(se(e)),y:k.y.map((function(t){return e}))});o.push(t)}()}return o=function(e){var t,a=0,n=Object(l.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.line=r.line||{};var c=0;r._isAvg&&(a-=1,c=.5);var i=ce()(fe[a%fe.length]);r.line.color=i.fade(c).rgb().string(),a+=1}}catch(w){n.e(w)}finally{n.f()}return e}(o=o.sort((function(e,t){var a=[e,t].map((function(e){return e._cat.replace("_","A".repeat(10))})),n=Object(u.a)(a,2);return(e=n[0])<(t=n[1])?-1:1})))},ge=function(e){var t=e.includeAverages,a=e.setIncludeAverages;return Object(h.jsxs)("div",{style:{margin:"5pt 10pt"},children:["Include Avg. ",Object(h.jsx)("input",{type:"checkbox",checked:t,onChange:function(e){return a(e.target.checked)}})]})},Oe=function(e){var t=e.plotTx,a=e.txType,r=e.metaCategory,c=e.timeFrame,i=e.minTime,o=e.maxTime,s=e.setTableFilters,l=Object(n.useState)(!0),f=Object(u.a)(l,2),j=f[0],d=f[1],m="_all"===r?"metaCategory":"category",b=ie({allTx:t,groupOn:[m,c],includeAll:[!0,!1]}),g=he({groupedData:b,groupOn:m,timeFrame:c,minTime:i,maxTime:o,includeAverages:j}),O=be({timeFrame:c,minTime:i,maxTime:o,txType:a,metaCategory:r});return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(ge,{includeAverages:j,setIncludeAverages:d}),Object(h.jsx)(ne.a,{layout:O,data:g,useResizeHandler:!0,style:{width:"100%",height:"100%"},onClick:function(e){var t=e.points[0].data;if(!t._isAvg){var a={date:ue({d:e.points[0].x,timeFrame:c})};"_all"!==t._cat&&(a[m]=t._cat),s(a)}}})]})},ye=function(e){var t=e.plotTx,a=e.selectionValues,n=e.setTableFilters;return Object(h.jsx)("div",{style:{height:"550px"},children:"trend"===a.plotType?Object(h.jsx)(Oe,{plotTx:t,txType:a.txType,metaCategory:a.metaCategory,timeFrame:a.timeFrame,minTime:a.minTime,maxTime:a.maxTime,setTableFilters:n}):Object(h.jsx)(me,{plotTx:t,txType:a.txType,metaCategory:a.metaCategory,timeFrame:a.timeFrame,time:a.maxTime,setTableFilters:n})})},ve=a(230),xe=a(525),pe=(a(268),function(e){return e.replace("-","").replace("/","").replace(" ","")}),Ce=function(e){var t=e.show,a=e.metaCat,n=e.metaCategories,r=e.checkChanged,c=e.setCheckChanged,i=e.selectionValues;e.disabledMetaCategories,e.setDisabledMetaCategories;return Object(h.jsxs)("div",{style:Object(s.a)(Object(s.a)({},{marginTop:"5pt"}),t?{}:{display:"none"}),children:[Object(h.jsx)("input",{type:"checkbox",id:we(a),defaultChecked:!i.inactiveMetaCategories.includes(a),onChange:function(e){Te({catOrMetaCat:"metaCats",key:a,setCheckChanged:c})}}),Object(h.jsxs)("label",{for:we(a),children:["\xa0\xa0",a]}),Object(h.jsx)("div",{style:{marginLeft:"5pt"},children:n[a].map((function(e){return Object(h.jsxs)("div",{children:[Object(h.jsx)("input",{id:Me(e),type:"checkbox",defaultChecked:!i.inactiveCategories.includes(e),disabled:i.inactiveMetaCategories.includes(a)&&!r.metaCats[a]||!i.inactiveMetaCategories.includes(a)&&!!r.metaCats[a],onChange:function(){return Te({catOrMetaCat:"cats",key:e,setCheckChanged:c})}}),Object(h.jsxs)("label",{for:Me(e),children:["\xa0\xa0",e]})]})}))})]})},Te=function(e){var t=e.catOrMetaCat,a=e.key,n=e.setCheckChanged,r="cats"===t?"metaCats":"cats";n((function(e){var n=e[t],c=e[r];n[a]=!n[a];var i={};return i[t]=n,i[r]=c,i}))},ke=function(e){return b({array:Object.keys(e)}).map((function(e){return{originalValue:e,value:pe(e),label:e}}))},we=function(e){return"".concat(pe(e),"MetaCatSel")},Me=function(e){return"".concat(pe(e),"CatSel")},Fe=function(e){var t=e.show,a=e.setShow,r=e.metaCategories,c=e.selectionValues,i=e.setSelectionValues,o=ke(r),l=Object(n.useState)(o[0]),f=Object(u.a)(l,2),j=f[0],d=f[1],m=Object(n.useState)([]),b=Object(u.a)(m,2),g=b[0],O=b[1],y=Object(n.useState)({metaCats:{},cats:{}}),v=Object(u.a)(y,2),x=v[0],p=v[1],C=j.originalValue,T=function(){p({metaCats:{},cats:{}}),a(!1)};return Object(h.jsx)("div",{children:Object(h.jsxs)(xe.a,{show:t,children:[Object(h.jsx)(xe.a.Header,{children:Object(h.jsx)("h3",{children:"Category Detail"})}),Object(h.jsxs)(xe.a.Body,{children:["Select a meta-category",Object(h.jsx)(ve.a,{options:o,defaultValue:j,onChange:function(e){return d(e)}}),Object.keys(r).map((function(e){return Object(h.jsx)(Ce,{metaCat:e,metaCategories:r,checkChanged:x,setCheckChanged:p,selectionValues:c,disabledMetaCategories:g,setDisabledMetaCategories:O,show:e===C})}))]}),Object(h.jsxs)(xe.a.Footer,{children:[Object(h.jsx)("button",{onClick:function(){i((function(e){for(var t=e.inactiveMetaCategories,a=function(){var e=r[n];x.metaCats[e]&&(t.includes(e)?t=t.filter((function(t){return t!==e})):t.push(e))},n=0,r=Object.keys(x.metaCats);n<r.length;n++)a();for(var c=e.inactiveCategories,i=function(){var e=l[o];x.cats[e]&&(c.includes(e)?c=c.filter((function(t){return t!==e})):c.push(e))},o=0,l=Object.keys(x.cats);o<l.length;o++)i();return Object(s.a)(Object(s.a)({},e),{inactiveMetaCategories:t,inactiveCategories:c})})),T()},children:"Save"}),Object(h.jsx)("button",{onClick:function(){return T()},children:"Cancel"})]})]})})},Se=function(e){var t,a=e.show,r=e.setShow,c=e.selectionValues,i=e.setSelectionValues,o=e.allTags,f={},j=Object(l.a)(o);try{for(j.s();!(t=j.n()).done;){var d=t.value;f[d]=c.requiredTags.includes(d)?"must":c.forbiddenTags.includes(d)?"cannot":"can"}}catch(v){j.e(v)}finally{j.f()}var m=Object(n.useState)(f),b=Object(u.a)(m,2),g=b[0],O=b[1],y=function(e){i((function(t){var a={requiredTags:Object.keys(e).filter((function(t){return"must"===e[t]})),forbiddenTags:Object.keys(e).filter((function(t){return"cannot"===e[t]}))};return Object(s.a)(Object(s.a)({},t),a)})),r(!1)};return Object(h.jsx)("div",{children:Object(h.jsxs)(xe.a,{show:a,children:[Object(h.jsx)(xe.a.Header,{children:Object(h.jsx)("h3",{children:"Tag Detail"})}),Object(h.jsx)(xe.a.Body,{children:Object(h.jsxs)("table",{children:[Object(h.jsx)("thead",{children:Object(h.jsxs)("tr",{children:[Object(h.jsx)("td",{}),["Can Have","Must Have","Can't Have"].map((function(e){return Object(h.jsx)("td",{style:{textAlign:"center",padding:"5pt"},children:e})}))]})}),Object(h.jsx)("tbody",{children:o.map((function(e){return Object(h.jsxs)("tr",{children:[Object(h.jsx)("td",{children:e}),["can","must","cannot"].map((function(t){var a=(g[e]||"can")===t;return Object(h.jsx)("td",{style:{textAlign:"center"},children:Object(h.jsx)("input",{type:"radio",name:e,value:t,defaultChecked:a,onChange:function(e){O((function(t){var a={};return a[e.target.name]=e.target.value,Object(s.a)(Object(s.a)({},t),a)}))}})})}))]})}))})]})}),Object(h.jsxs)(xe.a.Footer,{children:[Object(h.jsx)("button",{onClick:function(){return y(g)},children:"Save"}),Object(h.jsx)("button",{onClick:function(){return y(f)},children:"Cancel"})]})]})})},Ve=function(e){var t=e.label,a=e.options,n=e.selectionKey,r=e.selectionValues,c=e.setSelectionValues,i=e.minLoadMonth,o=e.setMinLoadMonth,s=(a=a.map((function(e){return"string"===typeof e?e={value:e,label:e}:e})).map((function(e){return{originalValue:e.value,value:pe(e.value),label:e.label}}))).filter((function(e){return e.originalValue===r[n]}));return Object(h.jsxs)("div",{style:{width:"100pt",marginLeft:"10pt"},children:[t,Object(h.jsx)(ve.a,{options:a,value:s,onChange:function(e){var t=e.originalValue;if(Ae({key:n,val:t,setValueFunc:c}),"timeFrame"===n)if("trend"===r.plotType)if("year"===t){var a=r.minTime.slice(0,4);Ae({key:"minTime",val:a,setValueFunc:c}),Ae({key:"maxTime",val:r.maxTime.slice(0,4),setValueFunc:c}),a+"-01"<i&&o(a+"-01")}else Ae({key:"minTime",val:r.minTime+"-01",setValueFunc:c}),Ae({key:"maxTime",val:r.maxTime+"-12",setValueFunc:c});else if("year"===t){var s=r.maxTime.slice(0,4);Ae({key:"maxTime",val:s,setValueFunc:c}),s+"-01"<i&&o(s+"-01")}else Ae({key:"maxTime",val:r.maxTime+"-01",setValueFunc:c})}})]})},Ae=function(e){var t=e.key,a=e.val;(0,e.setValueFunc)((function(e){var n={};return n[t]=a,Object(s.a)(Object(s.a)({},e),n)}))},Ye=function(e){var t=e.selectionValues,a=e.setSelectionValues,r=e.allMetaCats,c=e.allTimes,i=e.metaCategories,o=e.allTags,l=Object(n.useContext)(g),f=l.settings,j=l.minLoadMonth,d=l.setMinLoadMonth,m=Object(n.useState)(!1),b=Object(u.a)(m,2),O=b[0],y=b[1],v=Object(n.useState)(!1),x=Object(u.a)(v,2),p=x[0],C=x[1],T=function(e){var t=e.settings,a=e.allMetaCats,n=e.selectionValues,r=e.allTimes,c=[[{label:"Category Grouping",options:Object.keys(t.metaCategories).filter((function(e){return"_default"!==e})),selectionKey:"metaCatVersion"},{label:"Category Changes",options:Object.keys(t.categoryChanges).filter((function(e){return"_default"!==e})),selectionKey:"categoryChangeVersion"}],[{label:"Transaction Type",options:[{value:"expense",label:"Expense"}],selectionKey:"txType"},{label:"Plot Type",options:[{value:"trend",label:"Trend"},{value:"singlePeriod",label:"Single Period"}],selectionKey:"plotType"},{label:"Meta Category",options:a,selectionKey:"metaCategory"}],[{label:"Time Frame",options:[{value:"month",label:"Month"},{value:"year",label:"Year"}],selectionKey:"timeFrame"}]],i=c.length-1;return"trend"===n.plotType?c[i]=c[i].concat([{label:"Start ".concat("month"===n.timeFrame?"Month":"Year"),options:r,selectionKey:"minTime"},{label:"End ".concat("month"===n.timeFrame?"Month":"Year"),options:r,selectionKey:"maxTime"}]):c[i]=c[i].concat([{label:"month"===n.timeFrame?"Month":"Year",options:r,selectionKey:"maxTime"}]),c}({settings:f,allMetaCats:r=[{value:"_all",label:"All"}].concat(r),selectionValues:t,allTimes:c}).map((function(e){var n=e.map((function(e){return Object(h.jsx)(Ve,Object(s.a)({selectionValues:t,setSelectionValues:a,minLoadMonth:j,setMinLoadMonth:d},e),e.selectionKey)}));return Object(h.jsx)("div",{style:{display:"flex",marginTop:"5pt"},children:n},e[0].selectionKey)}));return T.push(Object(h.jsxs)("div",{style:{margin:"10pt"},children:[Object(h.jsx)("button",{onClick:function(){return y(!0)},style:{marginRight:"5pt"},children:"Category Detail"}),Object(h.jsx)("button",{onClick:function(){return C(!0)},children:"Tag Detail"}),Object(h.jsx)(Fe,{show:O,setShow:y,selectionValues:t,setSelectionValues:a,metaCategories:i}),Object(h.jsx)(Se,{show:p,setShow:C,selectionValues:t,setSelectionValues:a,allTags:o})]})),T.push(Object(h.jsx)("hr",{})),Object(h.jsx)(h.Fragment,{children:T})},De=function(e){for(var t=e.transactions,a=e.metaCategories,n=e.categoryChanges,r=Object.keys(n||{}),c={},i=0,o=Object.keys(a||{});i<o.length;i++){var u,f=o[i],j=Object(l.a)(a[f]);try{for(j.s();!(u=j.n()).done;){c[u.value]=f}}catch(g){j.e(g)}finally{j.f()}}var d,b=Object(l.a)(t);try{for(b.s();!(d=b.n()).done;){var h=d.value;r.includes(h.category)&&(h.category=n[h.category]),h.metaCategory=c[h.category]||"Misc",h.type=h.amount<0?"expense":"income",h.tags=h.tags||[],"string"===typeof h.tags&&(h.tags=h.tags.split(",")),h.tags=h.tags.filter((function(e){return""!==e.trim()})),h.month=m()(h.date).format("YYYY-MM"),h.year=m()(h.date).format("YYYY")}}catch(g){b.e(g)}finally{b.f()}return t.filter((function(e){return"Ignore"!==e.metaCategory})).map((function(e){return Object(s.a)(Object(s.a)({},e),{amount:Math.abs(e.amount)})}))},_e=function(e){var t=e.history,a=Object(n.useContext)(g),r=a.currentUser,c=a.setCurrentUser,i=a.txData,o=a.settings,j=a.minLoadMonth,d=a.maxLoadMonth,O=a.setMinLoadMonth,y=a.loadingData,v=Object(n.useState)({metaCatVersion:void 0,categoryChangeVersion:void 0,txType:"expense",inactiveCategories:[],inactiveMetaCategories:[],requiredTags:[],forbiddenTags:[],plotType:"trend",metaCategory:"_all",timeFrame:"month",minTime:void 0,maxTime:void 0}),p=Object(u.a)(v,2),C=p[0],T=p[1],k=Object(n.useState)({}),w=Object(u.a)(k,2),M=w[0],F=w[1],S=Object(n.useState)(y),V=Object(u.a)(S,2),A=V[0],Y=V[1];Object(n.useEffect)((function(){Y(y)}),[y]),Object(n.useEffect)((function(){C.minTime&&O((function(e){var t=4===C.minTime.length?C.minTime+"-01":C.minTime;return t<e?t:e}))}),[C.minTime,O]),Object(n.useEffect)((function(){o&&j&&d&&T((function(e){var t={};return e.metaCatVersion||(t.metaCatVersion=(o.metaCategories||{})._default),e.categoryChanges||(t.categoryChangeVersion=(o.categoryChanges||{})._default),e.minTime||(t.minTime=j),e.maxTime||(t.maxTime=d),Object(s.a)(Object(s.a)({},e),t)}))}),[o,j,d]);for(var D=[],_=0,R=Object.keys(i||{});_<R.length;_++){var L=R[_];D=D.concat(De({transactions:i[L],metaCategories:o.metaCategories[C.metaCatVersion],categoryChanges:o.categoryChanges[C.categoryChangeVersion]}))}if(r||t.push("/fin-trans/login"),!o||!C.metaCatVersion||!C.categoryChangeVersion)return Object(h.jsx)("div",{children:"Loading..."});var P,K=[],E=Object(l.a)(D);try{for(E.s();!(P=E.n()).done;){var I=P.value;K=K.concat(I.tags||[])}}catch(z){E.e(z)}finally{E.f()}K=b({array:K}),D=(D=D.filter((function(e){return e[C.timeFrame]>=C.minTime&&e[C.timeFrame]<=C.maxTime&&e.type===C.txType&&!C.inactiveCategories.includes(e.category)&&!C.inactiveMetaCategories.includes(e.metaCategory)&&(e.tags||[]).map((function(e){return C.requiredTags.includes(e)?1:0})).reduce((function(e,t){return e+t}),0)===C.requiredTags.length&&0===(e.tags||[]).map((function(e){return C.forbiddenTags.includes(e)?1:0})).reduce((function(e,t){return e+t}),0)}))).filter((function(e){return"trend"===C.plotType?e[C.timeFrame]>=C.minTime&&e[C.timeFrame]<=C.maxTime:e[C.timeFrame]===C.maxTime}));var U=b({array:D.map((function(e){return e.metaCategory}))});D=D.filter((function(e){return"_all"===C.metaCategory||e.metaCategory===C.metaCategory}));var H=function(e){for(var t=e.minTime,a=e.maxTime,n=e.timeFrame,r=e.reverse,c=void 0!==r&&r,i=[],o=t;o<=a;){var s=o;i.push(s),o=m()(s+("month"===n?"-01":"-01-01")).add(1,n).format("month"===n?"YYYY-MM":"YYYY")}return c&&i.reverse(),i}({minTime:o.general.minMonth,maxTime:o.general.maxMonth,timeFrame:C.timeFrame,reverse:!0});return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("button",{onClick:function(){window.confirm("Are you sure you want to sign out?")&&f.auth().signOut(),c(),t.push("/fin-trans/login")},children:"Sign Out"}),Object(h.jsx)(Ye,{selectionValues:C,setSelectionValues:T,allMetaCats:U,allTimes:H,metaCategories:o.metaCategories[C.metaCatVersion],allTags:K}),A?Object(h.jsx)("h3",{style:{textAlign:"center"},children:"Waiting for data to load..."}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)(x.a,{defaultActiveKey:"0",children:[Object(h.jsx)(x.a.Toggle,{eventKey:"0",children:"Toggle Plot"}),Object(h.jsx)(x.a.Collapse,{eventKey:"0",children:Object(h.jsx)(ye,{plotTx:D,selectionValues:C,setTableFilters:F})})]}),Object(h.jsx)("hr",{}),Object(h.jsxs)(x.a,{defaultActiveKey:"0",children:[Object(h.jsx)(x.a.Toggle,{eventKey:"0",children:"Toggle Table"}),Object(h.jsx)(x.a.Collapse,{eventKey:"0",children:Object(h.jsx)(te,{transactions:D,filterValues:M})})]})]})]})},Re=a(174),Le=a.n(Re),Pe=a(279),Ke=a(398),Ee=a.n(Ke),Ie=j.collection("months"),Ue=function(){var e=Object(Pe.a)(Le.a.mark((function e(t){var a,n,r,c,i,o,s,u,f;return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=b({array:t.map((function(e){return e.date.slice(0,7)}))}),n={},r={},c=Object(l.a)(a),e.prev=4,c.s();case 6:if((i=c.n()).done){e.next=14;break}return o=i.value,r[o]=[],e.next=11,He(o);case 11:n[o]=e.sent;case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),c.e(e.t0);case 19:return e.prev=19,c.f(),e.finish(19);case 22:t.map((function(e){return r[e.date.slice(0,7)].push(e)})),s=Object(l.a)(a);try{for(f=function(){var e=u.value,t=n[e].concat(r[e]);Ie.doc(e).set({transactions:t},{merge:!0}).then((function(){window.alert("Transactions uploaded successfully for month "+e)})).catch((function(e){window.alert("There was an issue uploading the transactions: ",e)}))},s.s();!(u=s.n()).done;)f()}catch(j){s.e(j)}finally{s.f()}case 25:case"end":return e.stop()}}),e,null,[[4,16,19,22]])})));return function(t){return e.apply(this,arguments)}}(),He=function(){var e=Object(Pe.a)(Le.a.mark((function e(t){var a;return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(t);case 2:return a=e.sent,e.abrupt("return",a.transactions||[]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ze=function(e){return Ie.doc(e).get().then((function(t){return t.exists?t.data():(qe(e),{transactions:[]})})).catch((function(e){return console.log("Error getting documents: ",e),null}))};function qe(e){var t=j.doc("settings/general");t.get().then((function(a){var n=a.data();e<n.minMonth?t.set({minMonth:e},{merge:!0}):e>n.maxMonth&&t.set({maxMonth:e},{merge:!0})})).catch((function(e){return console.log("Error getting settings: ",e),null}))}var Be=function(){return Object(h.jsx)(Ee.a,{cssClass:"csv-reader-input",label:"Select CSV to upload",parserOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0,transformHeader:function(e){return e.toLowerCase().replace(/\W/g,"_")}},onFileLoaded:Ue,onError:function(e){return console.log(e)}})},Ne=a(529),We=a(526),Ge=a(150),Je=function(){return Object(h.jsxs)(Ne.a,{bg:"dark",variant:"dark",expand:"lg",children:[Object(h.jsx)(Ne.a.Brand,{as:Ge.b,to:"/",children:"Transactions"}),Object(h.jsx)(Ne.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(h.jsx)(Ne.a.Collapse,{id:"basic-navbar-nav",children:Object(h.jsxs)(We.a,{className:"mr-auto",children:[Object(h.jsx)(We.a.Link,{as:Ge.b,to:"/upload",children:"Upload"}),Object(h.jsx)(We.a.Link,{as:Ge.b,to:"/edit",children:"Edit"})]})})]})},Ze=a(38),Qe=a(100),Xe=function(){var e=Object(n.useContext)(g),t=e.currentUser,a=e.txData,r=Object(n.useState)([]),c=Object(u.a)(r,2),i=c[0],o=c[1],s=function(){for(var e=[],t=0,n=Object.values(a||{});t<n.length;t++){var r,c=n[t],i=Object(l.a)(c);try{for(i.s();!(r=i.n()).done;){var o=r.value;o.tags&&(o.tags="string"===typeof o.tags?o.tags:o.tags.join(",")),e.push(o)}}catch(s){i.e(s)}finally{i.f()}}return e},f=Object(n.useState)(s()),j=Object(u.a)(f,2),d=j[0],m=j[1];if(!t)return Object(h.jsx)("div",{children:"Loading..."});return Object(h.jsxs)("div",{children:[Object(h.jsx)("button",{onClick:function(){m(s()),o([])},children:"Undo All"}),Object(h.jsx)("button",{onClick:function(){var e,t=Object(l.a)(b({array:i}));try{var n=function(){var t=e.value,n=d.filter((function(e){return e.date.slice(0,7)===t}));Ie.doc(t).set({transactions:n},{merge:!0}).then((function(){window.alert("Transactions uploaded successfully for month "+t)})).catch((function(e){window.alert("There was an issue uploading the transactions: ",e)})),Object.keys(a).includes(t)||qe(t)};for(t.s();!(e=t.n()).done;)n()}catch(r){t.e(r)}finally{t.f()}o([])},children:"Save All"}),Object(h.jsx)(Ze.a,{when:i.length>0,message:"You have unsaved changes. Please either save or undo changes."}),Object(h.jsx)(C.a,{title:"Raw Transaction Data",data:d,columns:[{title:"Date",field:"date",defaultSort:"desc"},{title:"Description",field:"description"},{title:"Amount",field:"amount"},{title:"Category",field:"category"},{title:"Comments",field:"comments"},{title:"Tags",field:"tags"},{title:"Account",field:"account"},{title:"Amortization (Months)",field:"amortize"}],icons:ee,options:{filtering:!0},editable:{onRowAdd:function(e){return new Promise((function(t,a){setTimeout((function(){m([].concat(Object(Qe.a)(d),[e])),o([].concat(Object(Qe.a)(i),[e.date.slice(0,7)])),t()}),1e3)}))},onRowUpdate:function(e,t){return new Promise((function(a,n){setTimeout((function(){var n=Object(Qe.a)(d);n[t.tableData.id]=e,m(Object(Qe.a)(n)),o([].concat(Object(Qe.a)(i),[e.date.slice(0,7),t.date.slice(0,7)])),a()}),1e3)}))},onRowDelete:function(e){return new Promise((function(t,a){setTimeout((function(){var a=Object(Qe.a)(d),n=e.tableData.id;a.splice(n,1),m(Object(Qe.a)(a)),o([].concat(Object(Qe.a)(i),[e.date.slice(0,7)])),t()}),1e3)}))}}})]})},$e=function(){return Object(h.jsx)(y,{children:Object(h.jsxs)(Ge.a,{children:[Object(h.jsx)(Je,{}),Object(h.jsx)(Ze.d,{children:Object(h.jsxs)("div",{style:{margin:"5pt"},children:[Object(h.jsx)(Ze.b,{exact:!0,path:"/fin-trans",component:_e}),Object(h.jsx)(Ze.b,{exact:!0,path:"/fin-trans/login",component:v}),Object(h.jsx)(Ze.b,{exact:!0,path:"/fin-trans/upload",component:Be}),Object(h.jsx)(Ze.b,{exact:!0,path:"/fin-trans/edit",component:Xe})]})})]})})};i.a.render(Object(h.jsx)(r.a.StrictMode,{children:Object(h.jsx)($e,{})}),document.getElementById("root"))}},[[493,1,2]]]);
//# sourceMappingURL=main.5cd57eec.chunk.js.map