(this["webpackJsonpfin-trans"]=this["webpackJsonpfin-trans"]||[]).push([[0],{493:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(21),i=a.n(c),o=a(93),s=a(14),l=a(32),u=a(28),f=(a(416),a(494),o.a.initializeApp({apiKey:"AIzaSyDIpxHzHlYDZ1jthEAl5FqVVvH1-Wa-iic",authDomain:"finances-270712.firebaseapp.com",databaseURL:"https://finances-270712.firebaseio.com",projectId:"finances-270712",storageBucket:"finances-270712.appspot.com",messagingSenderId:"974035741943"})),m=o.a.firestore(),d=a(47),j=a.n(d),b=function(e){var t=e.array,a=e.reverse,n=void 0!==a&&a,r=Array.from(new Set(t)).sort();return n?r.reverse():r},h=a(7),O=r.a.createContext(),g="YYYY-MM",p=function(e){var t=e.children,a=Object(n.useState)(),r=Object(u.a)(a,2),c=r[0],i=r[1],d=Object(n.useState)(),p=Object(u.a)(d,2),y=p[0],v=p[1],x=Object(n.useState)([]),C=Object(u.a)(x,2),T=C[0],k=C[1],M=Object(n.useState)(),w=Object(u.a)(M,2),F=w[0],S=w[1],V=Object(n.useState)({}),Y=Object(u.a)(V,2),A=Y[0],D=Y[1],z=Object(n.useState)(),_=Object(u.a)(z,2),R=_[0],L=_[1],I=Object(n.useState)(!0),P=Object(u.a)(I,2),K=P[0],E=P[1];return Object(n.useEffect)((function(){f.auth().onAuthStateChanged((function(e){if(e&&(L(e),0===Object.keys(A).length&&m.collection("settings").where(o.a.firestore.FieldPath.documentId(),"in",["categoryChanges","metaCategories","general"]).onSnapshot((function(e){var t,a={},n=Object(l.a)(e.docs);try{for(n.s();!(t=n.n()).done;){var r=t.value,c=r.id,i=r.data()||{};a[c]=i}}catch(o){n.e(o)}finally{n.f()}D(a)})),A.general)){c!==A.general.minMonth&&(i(j()(A.general.maxMonth).add(-11,"month").format(g)),v(j()(A.general.maxMonth).format(g)));for(var t=j()(c+"-01").format(g),a=[];t<=y;){var n=t;Object.keys(F||{}).includes(n)||a.push(n),t=j()(t+"-01").add(1,"month").format(g)}if(a.filter((function(e){return!T.includes(e)})).length>0){var r=b({array:T.concat(a)});m.collection("months").where(o.a.firestore.FieldPath.documentId(),">=",r[0]).where(o.a.firestore.FieldPath.documentId(),"<=",r[r.length-1]).onSnapshot((function(e){E(!0);var t,a={},n=Object(l.a)(e.docs);try{for(n.s();!(t=n.n()).done;){var r,c=t.value,i=c.id,o=(c.data()||{}).transactions||[],u=Object(l.a)(o);try{for(u.s();!(r=u.n()).done;){var f=r.value;Object.keys(f).includes("comment")&&!Object.keys(f).includes("comments")&&(f.comments=f.comment)}}catch(m){u.e(m)}finally{u.f()}a[i]=o}}catch(m){n.e(m)}finally{n.f()}S((function(e){return Object(s.a)(Object(s.a)({},e),a)})),E(!1)})),k(r)}}}))}),[c,y,F,A,T]),Object(h.jsx)(O.Provider,{value:{currentUser:R,txData:F,setMinLoadMonth:i,setCurrentUser:L,settings:A,minLoadMonth:c,maxLoadMonth:y,loadingData:K},children:t})},y=function(e){var t=e.history;Object(n.useContext)(O).currentUser&&t.push("/fin-trans");var a=o.a.auth(),r=new o.a.auth.GoogleAuthProvider;return Object(h.jsx)("button",{className:"login-provider-button",onClick:function(){a.signInWithPopup(r).then((function(e){t.push("/fin-trans")})).catch((function(e){console.log(e.message)}))},children:Object(h.jsx)("span",{children:"Sign in with Google"})})},v=a(528),x=a(166),C=a.n(x),T=a(383),k=a.n(T),M=a(393),w=a.n(M),F=a(384),S=a.n(F),V=a(391),Y=a.n(V),A=a(278),D=a.n(A),z=a(277),_=a.n(z),R=a(385),L=a.n(R),I=a(386),P=a.n(I),K=a(388),E=a.n(K),U=a(389),H=a.n(U),q=a(390),N=a.n(q),B=a(394),W=a.n(B),G=a(387),J=a.n(G),Z=a(392),Q=a.n(Z),X=a(395),$=a.n(X),ee={Add:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(k.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Check:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(S.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Clear:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(_.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Delete:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(L.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),DetailPanel:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(D.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Edit:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(P.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Export:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(J.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Filter:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(E.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),FirstPage:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(H.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),LastPage:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(N.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),NextPage:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(D.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),PreviousPage:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(Y.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),ResetSearch:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(_.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),Search:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(Q.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),SortArrow:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(w.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),ThirdStateCheck:Object(n.forwardRef)((function(e,t){return Object(h.jsx)(W.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))})),ViewColumn:Object(n.forwardRef)((function(e,t){return Object(h.jsx)($.a,Object(s.a)(Object(s.a)({},e),{},{ref:t}))}))},te=function(e){for(var t=e.transactions,a=e.filterValues,n=void 0===a?{}:a,r=[{title:"Date",field:"date",defaultSort:"desc"},{title:"Amount",field:"amount",type:"currency"},{title:"Category",field:"category"},{title:"Meta Category",field:"metaCategory"},{title:"Account",field:"account"},{title:"Tags",field:"tags"},{title:"Description",field:"description"},{title:"Comments",field:"comments"}],c=0,i=r;c<i.length;c++){var o=i[c];Object.keys(n).includes(o.field)&&(o.defaultFilter=n[o.field])}return Object(h.jsx)("div",{children:Object(h.jsx)(C.a,{title:"Transactions",data:t,columns:r,icons:ee,options:{filtering:!0}})})},ae=a(225),ne=a.n(ae),re=a(396),ce=a.n(re),ie=function e(t){var a,n=t.allTx,r=t.groupOn,c=t.includeAll,i=Array.isArray(r)?[r[0],r.slice(1)]:[r,[]],o=Object(u.a)(i,2),s=o[0],f=o[1],m=Array.isArray(c)?[c[0],c.slice(1)]:[c,[]],d=Object(u.a)(m,2),j=d[0],h=d[1],O=b({array:n.map((function(e){return e[s]}))}),g={},p=Object(l.a)(O);try{for(p.s();!(a=p.n()).done;){g[a.value]=[]}}catch(M){p.e(M)}finally{p.f()}var y,v=Object(l.a)(n);try{for(v.s();!(y=v.n()).done;){var x=y.value;g[x[s]].push(x)}}catch(M){v.e(M)}finally{v.f()}if(j&&(g._all=n),f.length>0)for(var C=0,T=Object.keys(g);C<T.length;C++){var k=T[C];g[k]=e({allTx:g[k],groupOn:f,includeAll:h})}return g},oe=function(e){var t=e.timeFrame,a=e.time;return"month"===t?j()(a+"-01").add(1,"month").format("YYYY-MM"):j()(a+"-01-01").add(1,"year").format("YYYY")},se=function(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)},le=function(e){var t=e.d;return"month"===e.timeFrame?j()(t+"-01").format("MMM YYYY"):t},ue=function(e){var t=e.d;return"month"===e.timeFrame?j()("1 "+t).format("YYYY-MM"):t},fe=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],me=function(e){var t,a=e.groupedData,n={type:"bar",hoverinfo:"text",x:[],y:[],text:[]},r=Object(l.a)(b({array:Object.keys(a)}));try{for(r.s();!(t=r.n()).done;){var c=t.value,i=a[c].map((function(e){return e.amount})).reduce((function(e,t){return e+t}),0);n.x.push(c),n.y.push(i),n.text.push("".concat(c,"<br>").concat(se(i)))}}catch(o){r.e(o)}finally{r.f()}return[n]},de=function(e){var t=e.timeFrame,a=e.time,n=e.txType,r=e.metaCategory;return{title:"".concat("_all"===r?"All":r," ").concat("expense"===n?"Expenses":"Income"," - ").concat(le({d:a,timeFrame:t})),autosize:!0,hovermode:"closest"}},je=function(e){var t=e.plotTx,a=e.metaCategory,n=e.timeFrame,r=e.time,c=e.txType,i=e.setTableFilters,o="_all"===a?"metaCategory":"category",s=ie({allTx:t,groupOn:[o],includeAll:[!1]}),l=me({groupedData:s}),u=de({timeFrame:n,time:r,txType:c,metaCategory:a});return Object(h.jsx)(ne.a,{layout:u,data:l,useResizeHandler:!0,style:{width:"100%",height:"100%"},onClick:function(e){var t={};t[o]=e.points[0].x,i(t)}})},be=function(e){var t=e.timeFrame,a=e.minTime,n=e.maxTime,r=e.txType,c=e.metaCategory,i="".concat("month"===t?"Month":"Year","ly Trends - ").concat("expense"===r?"Expenses":"Income").concat("_all"===c?"":" - "+c),o="".concat(le({d:a,timeFrame:t})," - ").concat(le({d:n,timeFrame:t}));return{title:"".concat(i,"<br><sub>").concat(o,"</sub>"),autosize:!0,hovermode:"closest"}},he=function(e){for(var t=e.groupedData,a=e.groupOn,n=e.timeFrame,r=e.minTime,c=e.maxTime,i=e.includeAverages,o=[],f=0,m=Object.entries(t);f<m.length;f++){for(var d=Object(u.a)(m[f],2),j=d[0],b=d[1],h=r,O=[],g=[],p=[],y="_all"===j?"Total":j;h<=c;){O.push(le({d:h,timeFrame:n}));var v,x=0,C=Object(l.a)(b[h]||[]);try{for(C.s();!(v=C.n()).done;){x+=v.value.amount}}catch(M){C.e(M)}finally{C.f()}g.push(x),p.push("".concat(y,"<br>").concat(le({d:h,timeFrame:n}),"<br>").concat(se(x))),h=oe({timeFrame:n,time:h})}var T=g.reduce((function(e,t){return e+t}),0),k={_cat:j,_groupOn:a,name:"".concat(y," - ").concat(se(T)),legendgroup:j,type:"scatter",hoverinfo:"text",text:p,x:O,y:g};o.push(k),i&&function(){var e=T/k.y.length,t=Object(s.a)(Object(s.a)({},k),{_cat:k._cat+"_avg",_isAvg:!0,line:{dash:"dash"},showlegend:!1,text:"Avg. ".concat(y,"<br>").concat(se(e)),y:k.y.map((function(t){return e}))});o.push(t)}()}return o=o.sort((function(e,t){var a=[e,t].map((function(e){return e._cat.replace("_","A".repeat(10))})),n=Object(u.a)(a,2);return(e=n[0])<(t=n[1])?-1:1})),o=function(e){var t,a=0,n=Object(l.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.line=r.line||{};var c=0;r._isAvg&&(a-=1,c=.5);var i=ce()(fe[a%fe.length]);r.line.color=i.fade(c).rgb().string(),a+=1}}catch(M){n.e(M)}finally{n.f()}return e}(o)},Oe=function(e){var t=e.includeAverages,a=e.setIncludeAverages;return Object(h.jsxs)("div",{style:{margin:"5pt 10pt"},children:["Include Avg. ",Object(h.jsx)("input",{type:"checkbox",checked:t,onChange:function(e){return a(e.target.checked)}})]})},ge=function(e){var t=e.plotTx,a=e.txType,r=e.metaCategory,c=e.timeFrame,i=e.minTime,o=e.maxTime,s=e.setTableFilters,l=Object(n.useState)(!0),f=Object(u.a)(l,2),m=f[0],d=f[1],j="_all"===r?"metaCategory":"category",b=ie({allTx:t,groupOn:[j,c],includeAll:[!0,!1]}),O=he({groupedData:b,groupOn:j,timeFrame:c,minTime:i,maxTime:o,includeAverages:m}),g=be({timeFrame:c,minTime:i,maxTime:o,txType:a,metaCategory:r});return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(Oe,{includeAverages:m,setIncludeAverages:d}),Object(h.jsx)(ne.a,{layout:g,data:O,useResizeHandler:!0,style:{width:"100%",height:"100%"},onClick:function(e){var t=e.points[0].data;if(!t._isAvg){var a={date:ue({d:e.points[0].x,timeFrame:c})};"_all"!==t._cat&&(a[j]=t._cat),s(a)}}})]})},pe=function(e){var t=e.plotTx,a=e.selectionValues,n=e.setTableFilters;return Object(h.jsx)("div",{style:{height:"550px"},children:"trend"===a.plotType?Object(h.jsx)(ge,{plotTx:t,txType:a.txType,metaCategory:a.metaCategory,timeFrame:a.timeFrame,minTime:a.minTime,maxTime:a.maxTime,setTableFilters:n}):Object(h.jsx)(je,{plotTx:t,txType:a.txType,metaCategory:a.metaCategory,timeFrame:a.timeFrame,time:a.maxTime,setTableFilters:n})})},ye=a(230),ve=a(525),xe=(a(268),function(e){return e.replace("-","").replace("/","").replace(" ","")}),Ce=function(e){var t=e.show,a=e.metaCat,n=e.metaCategories,r=e.checkChanged,c=e.setCheckChanged,i=e.selectionValues;e.disabledMetaCategories,e.setDisabledMetaCategories;return Object(h.jsxs)("div",{style:Object(s.a)(Object(s.a)({},{marginTop:"5pt"}),t?{}:{display:"none"}),children:[Object(h.jsx)("input",{type:"checkbox",id:Me(a),defaultChecked:!i.inactiveMetaCategories.includes(a),onChange:function(e){Te({catOrMetaCat:"metaCats",key:a,setCheckChanged:c})}}),Object(h.jsxs)("label",{for:Me(a),children:["\xa0\xa0",a]}),Object(h.jsx)("div",{style:{marginLeft:"5pt"},children:n[a].map((function(e){return Object(h.jsxs)("div",{children:[Object(h.jsx)("input",{id:we(e),type:"checkbox",defaultChecked:!i.inactiveCategories.includes(e),disabled:i.inactiveMetaCategories.includes(a)&&!r.metaCats[a]||!i.inactiveMetaCategories.includes(a)&&!!r.metaCats[a],onChange:function(){return Te({catOrMetaCat:"cats",key:e,setCheckChanged:c})}}),Object(h.jsxs)("label",{for:we(e),children:["\xa0\xa0",e]})]})}))})]})},Te=function(e){var t=e.catOrMetaCat,a=e.key,n=e.setCheckChanged,r="cats"===t?"metaCats":"cats";n((function(e){var n=e[t],c=e[r];n[a]=!n[a];var i={};return i[t]=n,i[r]=c,i}))},ke=function(e){return b({array:Object.keys(e)}).map((function(e){return{originalValue:e,value:xe(e),label:e}}))},Me=function(e){return"".concat(xe(e),"MetaCatSel")},we=function(e){return"".concat(xe(e),"CatSel")},Fe=function(e){var t=e.show,a=e.setShow,r=e.metaCategories,c=e.selectionValues,i=e.setSelectionValues,o=ke(r),l=Object(n.useState)(o[0]),f=Object(u.a)(l,2),m=f[0],d=f[1],j=Object(n.useState)([]),b=Object(u.a)(j,2),O=b[0],g=b[1],p=Object(n.useState)({metaCats:{},cats:{}}),y=Object(u.a)(p,2),v=y[0],x=y[1],C=m.originalValue,T=function(){x({metaCats:{},cats:{}}),a(!1)};return Object(h.jsx)("div",{children:Object(h.jsxs)(ve.a,{show:t,children:[Object(h.jsx)(ve.a.Header,{children:Object(h.jsx)("h3",{children:"Category Detail"})}),Object(h.jsxs)(ve.a.Body,{children:["Select a meta-category",Object(h.jsx)(ye.a,{options:o,defaultValue:m,onChange:function(e){return d(e)}}),Object.keys(r).map((function(e){return Object(h.jsx)(Ce,{metaCat:e,metaCategories:r,checkChanged:v,setCheckChanged:x,selectionValues:c,disabledMetaCategories:O,setDisabledMetaCategories:g,show:e===C})}))]}),Object(h.jsxs)(ve.a.Footer,{children:[Object(h.jsx)("button",{onClick:function(){i((function(e){for(var t=e.inactiveMetaCategories,a=function(){var e=r[n];v.metaCats[e]&&(t.includes(e)?t=t.filter((function(t){return t!==e})):t.push(e))},n=0,r=Object.keys(v.metaCats);n<r.length;n++)a();for(var c=e.inactiveCategories,i=function(){var e=l[o];v.cats[e]&&(c.includes(e)?c=c.filter((function(t){return t!==e})):c.push(e))},o=0,l=Object.keys(v.cats);o<l.length;o++)i();return Object(s.a)(Object(s.a)({},e),{inactiveMetaCategories:t,inactiveCategories:c})})),T()},children:"Save"}),Object(h.jsx)("button",{onClick:function(){return T()},children:"Cancel"})]})]})})},Se=function(e){var t,a=e.show,r=e.setShow,c=e.selectionValues,i=e.setSelectionValues,o=e.allTags,f={},m=Object(l.a)(o);try{for(m.s();!(t=m.n()).done;){var d=t.value;f[d]=c.requiredTags.includes(d)?"must":c.forbiddenTags.includes(d)?"cannot":"can"}}catch(y){m.e(y)}finally{m.f()}var j=Object(n.useState)(f),b=Object(u.a)(j,2),O=b[0],g=b[1],p=function(e){i((function(t){var a={requiredTags:Object.keys(e).filter((function(t){return"must"===e[t]})),forbiddenTags:Object.keys(e).filter((function(t){return"cannot"===e[t]}))};return Object(s.a)(Object(s.a)({},t),a)})),r(!1)};return Object(h.jsx)("div",{children:Object(h.jsxs)(ve.a,{show:a,children:[Object(h.jsx)(ve.a.Header,{children:Object(h.jsx)("h3",{children:"Tag Detail"})}),Object(h.jsx)(ve.a.Body,{children:Object(h.jsxs)("table",{children:[Object(h.jsx)("thead",{children:Object(h.jsxs)("tr",{children:[Object(h.jsx)("td",{}),["Can Have","Must Have","Can't Have"].map((function(e){return Object(h.jsx)("td",{style:{textAlign:"center",padding:"5pt"},children:e})}))]})}),Object(h.jsx)("tbody",{children:o.map((function(e){return Object(h.jsxs)("tr",{children:[Object(h.jsx)("td",{children:e}),["can","must","cannot"].map((function(t){var a=(O[e]||"can")===t;return Object(h.jsx)("td",{style:{textAlign:"center"},children:Object(h.jsx)("input",{type:"radio",name:e,value:t,defaultChecked:a,onChange:function(e){g((function(t){var a={};return a[e.target.name]=e.target.value,Object(s.a)(Object(s.a)({},t),a)}))}})})}))]})}))})]})}),Object(h.jsxs)(ve.a.Footer,{children:[Object(h.jsx)("button",{onClick:function(){return p(O)},children:"Save"}),Object(h.jsx)("button",{onClick:function(){return p(f)},children:"Cancel"})]})]})})},Ve=function(e){var t=e.label,a=e.options,n=e.selectionKey,r=e.selectionValues,c=e.setSelectionValues,i=e.minLoadMonth,o=e.setMinLoadMonth,s=(a=a.map((function(e){return"string"===typeof e?e={value:e,label:e}:e})).map((function(e){return{originalValue:e.value,value:xe(e.value),label:e.label}}))).filter((function(e){return e.originalValue===r[n]}));return Object(h.jsxs)("div",{style:{width:"100pt",marginLeft:"10pt"},children:[t,Object(h.jsx)(ye.a,{options:a,value:s,onChange:function(e){var t=e.originalValue;if(Ye({key:n,val:t,setValueFunc:c}),"timeFrame"===n)if("trend"===r.plotType)if("year"===t){var a=r.minTime.slice(0,4);Ye({key:"minTime",val:a,setValueFunc:c}),Ye({key:"maxTime",val:r.maxTime.slice(0,4),setValueFunc:c}),a+"-01"<i&&o(a+"-01")}else Ye({key:"minTime",val:r.minTime+"-01",setValueFunc:c}),Ye({key:"maxTime",val:r.maxTime+"-12",setValueFunc:c});else if("year"===t){var s=r.maxTime.slice(0,4);Ye({key:"maxTime",val:s,setValueFunc:c}),s+"-01"<i&&o(s+"-01")}else Ye({key:"maxTime",val:r.maxTime+"-01",setValueFunc:c})}})]})},Ye=function(e){var t=e.key,a=e.val;(0,e.setValueFunc)((function(e){var n={};return n[t]=a,Object(s.a)(Object(s.a)({},e),n)}))},Ae=function(e){var t=e.selectionValues,a=e.setSelectionValues,r=e.allMetaCats,c=e.allTimes,i=e.metaCategories,o=e.allTags,l=Object(n.useContext)(O),f=l.settings,m=l.minLoadMonth,d=l.setMinLoadMonth,j=Object(n.useState)(!1),b=Object(u.a)(j,2),g=b[0],p=b[1],y=Object(n.useState)(!1),v=Object(u.a)(y,2),x=v[0],C=v[1],T=function(e){var t=e.settings,a=e.allMetaCats,n=e.selectionValues,r=e.allTimes,c=[[{label:"Category Grouping",options:Object.keys(t.metaCategories).filter((function(e){return"_default"!==e})),selectionKey:"metaCatVersion"},{label:"Category Changes",options:Object.keys(t.categoryChanges).filter((function(e){return"_default"!==e})),selectionKey:"categoryChangeVersion"}],[{label:"Transaction Type",options:[{value:"expense",label:"Expense"}],selectionKey:"txType"},{label:"Plot Type",options:[{value:"trend",label:"Trend"},{value:"singlePeriod",label:"Single Period"}],selectionKey:"plotType"},{label:"Meta Category",options:a,selectionKey:"metaCategory"}],[{label:"Time Frame",options:[{value:"month",label:"Month"},{value:"year",label:"Year"}],selectionKey:"timeFrame"}]],i=c.length-1;return"trend"===n.plotType?c[i]=c[i].concat([{label:"Start ".concat("month"===n.timeFrame?"Month":"Year"),options:r,selectionKey:"minTime"},{label:"End ".concat("month"===n.timeFrame?"Month":"Year"),options:r,selectionKey:"maxTime"}]):c[i]=c[i].concat([{label:"month"===n.timeFrame?"Month":"Year",options:r,selectionKey:"maxTime"}]),c}({settings:f,allMetaCats:r=[{value:"_all",label:"All"}].concat(r),selectionValues:t,allTimes:c}),k=T.map((function(e){var n=e.map((function(e){return Object(h.jsx)(Ve,Object(s.a)({selectionValues:t,setSelectionValues:a,minLoadMonth:m,setMinLoadMonth:d},e),e.selectionKey)}));return Object(h.jsx)("div",{style:{display:"flex",marginTop:"5pt"},children:n},e[0].selectionKey)}));return k.push(Object(h.jsxs)("div",{style:{margin:"10pt"},children:[Object(h.jsx)("button",{onClick:function(){return p(!0)},style:{marginRight:"5pt"},children:"Category Detail"}),Object(h.jsx)("button",{onClick:function(){return C(!0)},children:"Tag Detail"}),Object(h.jsx)(Fe,{show:g,setShow:p,selectionValues:t,setSelectionValues:a,metaCategories:i}),Object(h.jsx)(Se,{show:x,setShow:C,selectionValues:t,setSelectionValues:a,allTags:o})]})),k.push(Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("input",{type:"checkbox",id:"selectAmortizeCheckbox",defaultChecked:t.amortize,onChange:function(){Ye({key:"amortize",val:!t.amortize,setValueFunc:a})}}),Object(h.jsx)("label",{for:"selectAmortizeCheckbox",children:"\xa0\xa0Use Amortization"})]})),k.push(Object(h.jsx)("hr",{})),Object(h.jsx)(h.Fragment,{children:k})},De=function(e){for(var t=e.transactions,a=e.metaCategories,n=e.categoryChanges,r=Object.keys(n||{}),c={},i=0,o=Object.keys(a||{});i<o.length;i++){var u,f=o[i],m=Object(l.a)(a[f]);try{for(m.s();!(u=m.n()).done;){c[u.value]=f}}catch(y){m.e(y)}finally{m.f()}}var d,b=[],h=Object(l.a)(t);try{for(h.s();!(d=h.n()).done;){var O=d.value;if(r.includes(O.category)&&(O.category=n[O.category]),O.metaCategory=c[O.category]||"Misc",O.type=O.amount<0?"expense":"income",O.tags=O.tags||[],"string"===typeof O.tags&&(O.tags=O.tags.split(",").map((function(e){return e.toLowerCase().trim()}))),O.tags=O.tags.filter((function(e){return""!==e.trim()})),O.month=j()(O.date).format("YYYY-MM"),O.year=j()(O.date).format("YYYY"),O.amortize){O.amortize=parseInt(O.amortize),O.skipIfAmortize=!0;for(var g=0;g<O.amortize;g++){var p={date:j()(O.date).add(g,"month").format("YYYY-MM-DD"),amount:O.amount/O.amortize,skipIfAmortize:!1,skipIfNoAmortize:!0};p.month=j()(p.date).format("YYYY-MM"),p.year=j()(p.date).format("YYYY"),b.push(Object(s.a)(Object(s.a)({},O),p))}}}}catch(y){h.e(y)}finally{h.f()}return t.concat(b).filter((function(e){return"Ignore"!==e.metaCategory})).map((function(e){return Object(s.a)(Object(s.a)({},e),{amount:Math.abs(e.amount)})}))},ze=function(e){var t=e.history,a=Object(n.useContext)(O),r=a.currentUser,c=a.setCurrentUser,i=a.txData,o=a.settings,m=a.minLoadMonth,d=a.maxLoadMonth,g=a.setMinLoadMonth,p=a.loadingData,y=Object(n.useState)({metaCatVersion:void 0,categoryChangeVersion:void 0,txType:"expense",inactiveCategories:[],inactiveMetaCategories:[],requiredTags:[],forbiddenTags:[],plotType:"trend",metaCategory:"_all",timeFrame:"month",minTime:void 0,maxTime:void 0,amortize:!1}),x=Object(u.a)(y,2),C=x[0],T=x[1],k=Object(n.useState)({}),M=Object(u.a)(k,2),w=M[0],F=M[1],S=Object(n.useState)(p),V=Object(u.a)(S,2),Y=V[0],A=V[1];Object(n.useEffect)((function(){A(p)}),[p]),Object(n.useEffect)((function(){C.minTime&&g((function(e){var t=4===C.minTime.length?C.minTime+"-01":C.minTime;return t<e?t:e}))}),[C.minTime,g]),Object(n.useEffect)((function(){o&&m&&d&&T((function(e){var t={};return e.metaCatVersion||(t.metaCatVersion=(o.metaCategories||{})._default),e.categoryChanges||(t.categoryChangeVersion=(o.categoryChanges||{})._default),e.minTime||(t.minTime=m),e.maxTime||(t.maxTime=d),Object(s.a)(Object(s.a)({},e),t)}))}),[o,m,d]);for(var D=[],z=0,_=Object.keys(i||{});z<_.length;z++){var R=_[z];D=D.concat(De({transactions:i[R],metaCategories:o.metaCategories[C.metaCatVersion],categoryChanges:o.categoryChanges[C.categoryChangeVersion]}))}if(r||t.push("/fin-trans/login"),!o||!C.metaCatVersion||!C.categoryChangeVersion)return Object(h.jsx)("div",{children:"Loading..."});var L,I=[],P=Object(l.a)(D);try{for(P.s();!(L=P.n()).done;){var K=L.value;I=I.concat(K.tags||[])}}catch(H){P.e(H)}finally{P.f()}I=b({array:I}),D=D.filter((function(e){return e[C.timeFrame]>=C.minTime&&e[C.timeFrame]<=C.maxTime&&e.type===C.txType&&!C.inactiveCategories.includes(e.category)&&!C.inactiveMetaCategories.includes(e.metaCategory)&&(e.tags||[]).map((function(e){return C.requiredTags.includes(e)?1:0})).reduce((function(e,t){return e+t}),0)===C.requiredTags.length&&0===(e.tags||[]).map((function(e){return C.forbiddenTags.includes(e)?1:0})).reduce((function(e,t){return e+t}),0)&&(C.amortize?!e.skipIfAmortize:!e.skipIfNoAmortize)})),D=D.filter((function(e){return"trend"===C.plotType?e[C.timeFrame]>=C.minTime&&e[C.timeFrame]<=C.maxTime:e[C.timeFrame]===C.maxTime}));var E=b({array:D.map((function(e){return e.metaCategory}))});D=D.filter((function(e){return"_all"===C.metaCategory||e.metaCategory===C.metaCategory}));var U=function(e){for(var t=e.minTime,a=e.maxTime,n=e.timeFrame,r=e.reverse,c=void 0!==r&&r,i=[],o=t;o<=a;){var s=o;i.push(s),o=j()(s+("month"===n?"-01":"-01-01")).add(1,n).format("month"===n?"YYYY-MM":"YYYY")}return c&&i.reverse(),i}({minTime:o.general.minMonth,maxTime:o.general.maxMonth,timeFrame:C.timeFrame,reverse:!0});return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("button",{onClick:function(){window.confirm("Are you sure you want to sign out?")&&f.auth().signOut(),c(),t.push("/fin-trans/login")},children:"Sign Out"}),Object(h.jsx)(Ae,{selectionValues:C,setSelectionValues:T,allMetaCats:E,allTimes:U,metaCategories:o.metaCategories[C.metaCatVersion],allTags:I}),Y?Object(h.jsx)("h3",{style:{textAlign:"center"},children:"Waiting for data to load..."}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)(v.a,{defaultActiveKey:"0",children:[Object(h.jsx)(v.a.Toggle,{eventKey:"0",children:"Toggle Plot"}),Object(h.jsx)(v.a.Collapse,{eventKey:"0",children:Object(h.jsx)(pe,{plotTx:D,selectionValues:C,setTableFilters:F})})]}),Object(h.jsx)("hr",{}),Object(h.jsxs)(v.a,{defaultActiveKey:"0",children:[Object(h.jsx)(v.a.Toggle,{eventKey:"0",children:"Toggle Table"}),Object(h.jsx)(v.a.Collapse,{eventKey:"0",children:Object(h.jsx)(te,{transactions:D,filterValues:w})})]})]})]})},_e=a(174),Re=a.n(_e),Le=a(279),Ie=a(398),Pe=a.n(Ie),Ke=m.collection("months"),Ee=function(){var e=Object(Le.a)(Re.a.mark((function e(t){var a,n,r,c,i,o,s,u,f,m,d,j;return Re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Object(l.a)(t);try{for(a.s();!(n=a.n()).done;)(r=n.value).date=new Date(Date.parse(r.date)).toISOString().substring(0,10)}catch(h){a.e(h)}finally{a.f()}c=b({array:t.map((function(e){return e.date.slice(0,7)}))}),i={},o={},s=Object(l.a)(c),e.prev=6,s.s();case 8:if((u=s.n()).done){e.next=16;break}return f=u.value,o[f]=[],e.next=13,Ue(f);case 13:i[f]=e.sent;case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),s.e(e.t0);case 21:return e.prev=21,s.f(),e.finish(21);case 24:t.map((function(e){return o[e.date.slice(0,7)].push(e)})),m=Object(l.a)(c);try{for(j=function(){var e=d.value,t=i[e].concat(o[e]);Ke.doc(e).set({transactions:t},{merge:!0}).then((function(){window.alert("Transactions uploaded successfully for month "+e)})).catch((function(e){window.alert("There was an issue uploading the transactions: ",e)}))},m.s();!(d=m.n()).done;)j()}catch(h){m.e(h)}finally{m.f()}case 27:case"end":return e.stop()}}),e,null,[[6,18,21,24]])})));return function(t){return e.apply(this,arguments)}}(),Ue=function(){var e=Object(Le.a)(Re.a.mark((function e(t){var a;return Re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He(t);case 2:return a=e.sent,e.abrupt("return",a.transactions||[]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),He=function(e){return Ke.doc(e).get().then((function(t){return t.exists?t.data():(qe(e),{transactions:[]})})).catch((function(e){return console.log("Error getting documents: ",e),null}))};function qe(e){var t=m.doc("settings/general");t.get().then((function(a){var n=a.data();e<n.minMonth?t.set({minMonth:e},{merge:!0}):e>n.maxMonth&&t.set({maxMonth:e},{merge:!0})})).catch((function(e){return console.log("Error getting settings: ",e),null}))}var Ne=function(){return Object(h.jsx)(Pe.a,{cssClass:"csv-reader-input",label:"Select CSV to upload",parserOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0,transformHeader:function(e){return e.toLowerCase().replace(/\W/g,"_")}},onFileLoaded:Ee,onError:function(e){return console.log(e)}})},Be=a(529),We=a(526),Ge=a(150),Je=function(){return Object(h.jsxs)(Be.a,{bg:"dark",variant:"dark",expand:"lg",children:[Object(h.jsx)(Be.a.Brand,{as:Ge.b,to:"/fin-trans",children:"Transactions"}),Object(h.jsx)(Be.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(h.jsx)(Be.a.Collapse,{id:"basic-navbar-nav",children:Object(h.jsxs)(We.a,{className:"mr-auto",children:[Object(h.jsx)(We.a.Link,{as:Ge.b,to:"/fin-trans/upload",children:"Upload"}),Object(h.jsx)(We.a.Link,{as:Ge.b,to:"/fin-trans/edit",children:"Edit"})]})})]})},Ze=a(38),Qe=a(100),Xe=function(){var e=Object(n.useContext)(O),t=e.currentUser,a=e.txData,r=Object(n.useState)([]),c=Object(u.a)(r,2),i=c[0],o=c[1],s=function(){for(var e=[],t=0,n=Object.values(a||{});t<n.length;t++){var r,c=n[t],i=Object(l.a)(c);try{for(i.s();!(r=i.n()).done;){var o=r.value;o.tags&&(o.tags="string"===typeof o.tags?o.tags:o.tags.join(",")),e.push(o)}}catch(s){i.e(s)}finally{i.f()}}return e},f=Object(n.useState)(s()),m=Object(u.a)(f,2),d=m[0],j=m[1];if(!t)return Object(h.jsx)("div",{children:"Loading..."});return Object(h.jsxs)("div",{children:[Object(h.jsx)("button",{onClick:function(){j(s()),o([])},children:"Undo All"}),Object(h.jsx)("button",{onClick:function(){var e,t=Object(l.a)(b({array:i}));try{var n=function(){var t=e.value,n=d.filter((function(e){return e.date.slice(0,7)===t}));Ke.doc(t).set({transactions:n},{merge:!0}).then((function(){window.alert("Transactions uploaded successfully for month "+t)})).catch((function(e){window.alert("There was an issue uploading the transactions: ",e)})),Object.keys(a).includes(t)||qe(t)};for(t.s();!(e=t.n()).done;)n()}catch(r){t.e(r)}finally{t.f()}o([])},children:"Save All"}),Object(h.jsx)(Ze.a,{when:i.length>0,message:"You have unsaved changes. Please either save or undo changes."}),Object(h.jsx)(C.a,{title:"Raw Transaction Data",data:d,columns:[{title:"Date",field:"date",defaultSort:"desc"},{title:"Description",field:"description"},{title:"Amount",field:"amount"},{title:"Category",field:"category"},{title:"Comments",field:"comments"},{title:"Tags",field:"tags"},{title:"Account",field:"account"},{title:"Amortization (Months)",field:"amortize"}],icons:ee,options:{filtering:!0},editable:{onRowAdd:function(e){return new Promise((function(t,a){setTimeout((function(){j([].concat(Object(Qe.a)(d),[e])),o([].concat(Object(Qe.a)(i),[e.date.slice(0,7)])),t()}),1e3)}))},onRowUpdate:function(e,t){return new Promise((function(a,n){setTimeout((function(){var n=Object(Qe.a)(d);n[t.tableData.id]=e,j(Object(Qe.a)(n)),o([].concat(Object(Qe.a)(i),[e.date.slice(0,7),t.date.slice(0,7)])),a()}),1e3)}))},onRowDelete:function(e){return new Promise((function(t,a){setTimeout((function(){var a=Object(Qe.a)(d),n=e.tableData.id;a.splice(n,1),j(Object(Qe.a)(a)),o([].concat(Object(Qe.a)(i),[e.date.slice(0,7)])),t()}),1e3)}))}}})]})},$e=function(){return Object(h.jsx)(p,{children:Object(h.jsxs)(Ge.a,{children:[Object(h.jsx)(Je,{}),Object(h.jsx)(Ze.d,{children:Object(h.jsxs)("div",{style:{margin:"5pt"},children:[Object(h.jsx)(Ze.b,{exact:!0,path:"/fin-trans",component:ze}),Object(h.jsx)(Ze.b,{exact:!0,path:"/fin-trans/login",component:y}),Object(h.jsx)(Ze.b,{exact:!0,path:"/fin-trans/upload",component:Ne}),Object(h.jsx)(Ze.b,{exact:!0,path:"/fin-trans/edit",component:Xe})]})})]})})};i.a.render(Object(h.jsx)(r.a.StrictMode,{children:Object(h.jsx)($e,{})}),document.getElementById("root"))}},[[493,1,2]]]);
//# sourceMappingURL=main.d50150bd.chunk.js.map